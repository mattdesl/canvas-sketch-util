!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).canvasSketchUtil=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}var n={exports:{}};!function(t){var r=256,n=[],a=void 0===e?window:e,i=Math.pow(r,6),o=Math.pow(2,52),f=2*o,u=255,s=Math.random;function c(e){var t,n=e.length,a=this,i=0,o=a.i=a.j=0,f=a.S=[];for(n||(e=[n++]);i<r;)f[i]=i++;for(i=0;i<r;i++)f[i]=f[o=u&o+e[i%n]+(t=f[i])],f[o]=t;(a.g=function(e){for(var t,n=0,i=a.i,o=a.j,f=a.S;e--;)t=f[i=u&i+1],n=n*r+f[u&(f[i]=f[o=u&o+t])+(f[o]=t)];return a.i=i,a.j=o,n})(r)}function l(e,t){var r,n=[],a=(typeof e)[0];if(t&&"o"==a)for(r in e)try{n.push(l(e[r],t-1))}catch(e){}return n.length?n:"s"==a?e:e+"\0"}function h(e,t){for(var r,n=e+"",a=0;a<n.length;)t[u&a]=u&(r^=19*t[u&a])+n.charCodeAt(a++);return d(t)}function p(e){try{return a.crypto.getRandomValues(e=new Uint8Array(r)),d(e)}catch(e){return[+new Date,a,a.navigator&&a.navigator.plugins,a.screen,d(n)]}}function d(e){return String.fromCharCode.apply(0,e)}t.exports=function(e,a){if(a&&!0===a.global)return a.global=!1,Math.random=t.exports(e,a),a.global=!0,Math.random;var u=a&&a.entropy||!1,s=[];h(l(u?[e,d(n)]:0 in arguments?e:p(),3),s);var m=new c(s);return h(d(m.S),n),function(){for(var e=m.g(6),t=i,n=0;e<o;)e=(e+n)*r,t*=r,n=m.g(1);for(;e>=f;)e/=2,t/=2,n>>>=1;return(e+n)/t}},t.exports.resetGlobal=function(){Math.random=s},h(Math.random(),n)}(n);var a={exports:{}};!function(e,t){!function(){var r=.5*(Math.sqrt(3)-1),n=(3-Math.sqrt(3))/6,a=1/6,i=(Math.sqrt(5)-1)/4,o=(5-Math.sqrt(5))/20;function f(e){var t;t="function"==typeof e?e:e?function(){var e=0,t=0,r=0,n=1,a=s();e=a(" "),t=a(" "),r=a(" ");for(var i=0;i<arguments.length;i++)(e-=a(arguments[i]))<0&&(e+=1),(t-=a(arguments[i]))<0&&(t+=1),(r-=a(arguments[i]))<0&&(r+=1);return a=null,function(){var a=2091639*e+2.3283064365386963e-10*n;return e=t,t=r,r=a-(n=0|a)}}(e):Math.random,this.p=u(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var r=0;r<512;r++)this.perm[r]=this.p[255&r],this.permMod12[r]=this.perm[r]%12}function u(e){var t,r=new Uint8Array(256);for(t=0;t<256;t++)r[t]=t;for(t=0;t<255;t++){var n=t+~~(e()*(256-t)),a=r[t];r[t]=r[n],r[n]=a}return r}function s(){var e=4022871197;return function(t){t=t.toString();for(var r=0;r<t.length;r++){var n=.02519603282416938*(e+=t.charCodeAt(r));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)}}f.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(e,t){var a,i,o=this.permMod12,f=this.perm,u=this.grad3,s=0,c=0,l=0,h=(e+t)*r,p=Math.floor(e+h),d=Math.floor(t+h),m=(p+d)*n,b=e-(p-m),v=t-(d-m);b>v?(a=1,i=0):(a=0,i=1);var g=b-a+n,y=v-i+n,x=b-1+2*n,w=v-1+2*n,k=255&p,M=255&d,A=.5-b*b-v*v;if(A>=0){var _=3*o[k+f[M]];s=(A*=A)*A*(u[_]*b+u[_+1]*v)}var S=.5-g*g-y*y;if(S>=0){var E=3*o[k+a+f[M+i]];c=(S*=S)*S*(u[E]*g+u[E+1]*y)}var T=.5-x*x-w*w;if(T>=0){var j=3*o[k+1+f[M+1]];l=(T*=T)*T*(u[j]*x+u[j+1]*w)}return 70*(s+c+l)},noise3D:function(e,t,r){var n,i,o,f,u,s,c,l,h,p,d=this.permMod12,m=this.perm,b=this.grad3,v=.3333333333333333*(e+t+r),g=Math.floor(e+v),y=Math.floor(t+v),x=Math.floor(r+v),w=(g+y+x)*a,k=e-(g-w),M=t-(y-w),A=r-(x-w);k>=M?M>=A?(u=1,s=0,c=0,l=1,h=1,p=0):k>=A?(u=1,s=0,c=0,l=1,h=0,p=1):(u=0,s=0,c=1,l=1,h=0,p=1):M<A?(u=0,s=0,c=1,l=0,h=1,p=1):k<A?(u=0,s=1,c=0,l=0,h=1,p=1):(u=0,s=1,c=0,l=1,h=1,p=0);var _=k-u+a,S=M-s+a,E=A-c+a,T=k-l+2*a,j=M-h+2*a,D=A-p+2*a,C=k-1+.5,O=M-1+.5,P=A-1+.5,F=255&g,z=255&y,B=255&x,L=.6-k*k-M*M-A*A;if(L<0)n=0;else{var I=3*d[F+m[z+m[B]]];n=(L*=L)*L*(b[I]*k+b[I+1]*M+b[I+2]*A)}var R=.6-_*_-S*S-E*E;if(R<0)i=0;else{var q=3*d[F+u+m[z+s+m[B+c]]];i=(R*=R)*R*(b[q]*_+b[q+1]*S+b[q+2]*E)}var G=.6-T*T-j*j-D*D;if(G<0)o=0;else{var H=3*d[F+l+m[z+h+m[B+p]]];o=(G*=G)*G*(b[H]*T+b[H+1]*j+b[H+2]*D)}var N=.6-C*C-O*O-P*P;if(N<0)f=0;else{var U=3*d[F+1+m[z+1+m[B+1]]];f=(N*=N)*N*(b[U]*C+b[U+1]*O+b[U+2]*P)}return 32*(n+i+o+f)},noise4D:function(e,t,r,n){var a,f,u,s,c,l,h,p,d,m,b,v,g,y,x,w,k,M=this.perm,A=this.grad4,_=(e+t+r+n)*i,S=Math.floor(e+_),E=Math.floor(t+_),T=Math.floor(r+_),j=Math.floor(n+_),D=(S+E+T+j)*o,C=e-(S-D),O=t-(E-D),P=r-(T-D),F=n-(j-D),z=0,B=0,L=0,I=0;C>O?z++:B++,C>P?z++:L++,C>F?z++:I++,O>P?B++:L++,O>F?B++:I++,P>F?L++:I++;var R=C-(l=z>=3?1:0)+o,q=O-(h=B>=3?1:0)+o,G=P-(p=L>=3?1:0)+o,H=F-(d=I>=3?1:0)+o,N=C-(m=z>=2?1:0)+2*o,U=O-(b=B>=2?1:0)+2*o,W=P-(v=L>=2?1:0)+2*o,V=F-(g=I>=2?1:0)+2*o,Q=C-(y=z>=1?1:0)+3*o,Y=O-(x=B>=1?1:0)+3*o,$=P-(w=L>=1?1:0)+3*o,X=F-(k=I>=1?1:0)+3*o,J=C-1+4*o,Z=O-1+4*o,K=P-1+4*o,ee=F-1+4*o,te=255&S,re=255&E,ne=255&T,ae=255&j,ie=.6-C*C-O*O-P*P-F*F;if(ie<0)a=0;else{var oe=M[te+M[re+M[ne+M[ae]]]]%32*4;a=(ie*=ie)*ie*(A[oe]*C+A[oe+1]*O+A[oe+2]*P+A[oe+3]*F)}var fe=.6-R*R-q*q-G*G-H*H;if(fe<0)f=0;else{var ue=M[te+l+M[re+h+M[ne+p+M[ae+d]]]]%32*4;f=(fe*=fe)*fe*(A[ue]*R+A[ue+1]*q+A[ue+2]*G+A[ue+3]*H)}var se=.6-N*N-U*U-W*W-V*V;if(se<0)u=0;else{var ce=M[te+m+M[re+b+M[ne+v+M[ae+g]]]]%32*4;u=(se*=se)*se*(A[ce]*N+A[ce+1]*U+A[ce+2]*W+A[ce+3]*V)}var le=.6-Q*Q-Y*Y-$*$-X*X;if(le<0)s=0;else{var he=M[te+y+M[re+x+M[ne+w+M[ae+k]]]]%32*4;s=(le*=le)*le*(A[he]*Q+A[he+1]*Y+A[he+2]*$+A[he+3]*X)}var pe=.6-J*J-Z*Z-K*K-ee*ee;if(pe<0)c=0;else{var de=M[te+1+M[re+1+M[ne+1+M[ae+1]]]]%32*4;c=(pe*=pe)*pe*(A[de]*J+A[de+1]*Z+A[de+2]*K+A[de+3]*ee)}return 27*(a+f+u+s+c)}},f._buildPermutationTable=u,t.SimplexNoise=f,e.exports=f}()}(a,a.exports);var i=function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]},o=n.exports,f=a.exports,u=i;var s=function e(t){t=u(t,null);var r,n,a,i=Math.random,s=null,c=!1;return l(t),{value:h,createRandom:function(t){return e(t)},setSeed:l,getSeed:function(){return r},getRandomSeed:function(){return String(Math.floor(1e6*Math.random()))},valueNonZero:function(){var e=0;for(;0===e;)e=h();return e},permuteNoise:function(){a=p()},noise1D:function(e,t,r){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");return t=u(t,1),(r=u(r,1))*a.noise2D(e*t,0)},noise2D:function(e,t,r,n){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");if(!isFinite(t))throw new TypeError("y component for noise() must be finite");return r=u(r,1),(n=u(n,1))*a.noise2D(e*r,t*r)},noise3D:function(e,t,r,n,i){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");if(!isFinite(t))throw new TypeError("y component for noise() must be finite");if(!isFinite(r))throw new TypeError("z component for noise() must be finite");return n=u(n,1),(i=u(i,1))*a.noise3D(e*n,t*n,r*n)},noise4D:function(e,t,r,n,i,o){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");if(!isFinite(t))throw new TypeError("y component for noise() must be finite");if(!isFinite(r))throw new TypeError("z component for noise() must be finite");if(!isFinite(n))throw new TypeError("w component for noise() must be finite");return i=u(i,1),(o=u(o,1))*a.noise4D(e*i,t*i,r*i,n*i)},sign:function(){return d()?1:-1},boolean:d,chance:function(e){if("number"!=typeof(e=u(e,.5)))throw new TypeError("expected n to be a number");return h()<e},range:m,rangeFloor:b,pick:function(e){return 0===e.length?void 0:e[b(0,e.length)]},shuffle:function(e){if(!Array.isArray(e))throw new TypeError("Expected Array, got "+typeof e);var t,r,n=e.length,a=e.slice();for(;n;)t=Math.floor(h()*n--),r=a[n],a[n]=a[t],a[t]=r;return a},onCircle:v,insideCircle:function(e,t){e=u(e,1),v(1,t=t||[]);var r=e*Math.sqrt(h());return t[0]*=r,t[1]*=r,t},onSphere:function(e,t){e=u(e,1),t=t||[];var r=h()*Math.PI*2,n=2*h()-1,a=r,i=Math.acos(n);return t[0]=e*Math.sin(i)*Math.cos(a),t[1]=e*Math.sin(i)*Math.sin(a),t[2]=e*Math.cos(i),t},insideSphere:function(e,t){e=u(e,1),t=t||[];var r=h()*Math.PI*2,n=2*h()-1,a=h(),i=r,o=Math.acos(n),f=e*Math.cbrt(a);return t[0]=f*Math.sin(o)*Math.cos(i),t[1]=f*Math.sin(o)*Math.sin(i),t[2]=f*Math.cos(o),t},quaternion:function(e){e=e||[];var t=h(),r=h(),n=h(),a=Math.sqrt(1-t),i=Math.sqrt(t),o=2*Math.PI*r,f=2*Math.PI*n,u=Math.sin(o)*a,s=Math.cos(o)*a,c=Math.sin(f)*i,l=Math.cos(f)*i;return e[0]=u,e[1]=s,e[2]=c,e[3]=l,e},weighted:y,weightedSet:function(e){return 0===(e=e||[]).length?null:e[g(e)].value},weightedSetIndex:g,gaussian:function(e,t){if(e=u(e,0),t=u(t,1),c){c=!1;var r=s;return s=null,e+t*r}var n=0,a=0,i=0;do{n=2*h()-1,a=2*h()-1,i=n*n+a*a}while(i>=1||0===i);var o=Math.sqrt(-2*Math.log(i)/i);return s=a*o,c=!0,e+t*(n*o)}};function l(e,t){"number"==typeof e||"string"==typeof e?n=o(r=e,t):(r=void 0,n=i),a=p(),s=null,c=!1}function h(){return n()}function p(){return new f(n)}function d(){return h()>.5}function m(e,t){if(void 0===t&&(t=e,e=0),"number"!=typeof e||"number"!=typeof t)throw new TypeError("Expected all arguments to be numbers");return h()*(t-e)+e}function b(e,t){if(void 0===t&&(t=e,e=0),"number"!=typeof e||"number"!=typeof t)throw new TypeError("Expected all arguments to be numbers");return Math.floor(m(e,t))}function v(e,t){e=u(e,1),t=t||[];var r=2*h()*Math.PI;return t[0]=e*Math.cos(r),t[1]=e*Math.sin(r),t}function g(e){return 0===(e=e||[]).length?-1:y(e.map((function(e){return e.weight})))}function y(e){if(0===(e=e||[]).length)return-1;var t,r=0;for(t=0;t<e.length;t++)r+=e[t];if(r<=0)throw new Error("Weights must sum to > 0");var n=h()*r;for(t=0;t<e.length;t++){if(n<e[t])return t;n-=e[t]}return 0}}(),c=function(e,t,r){if("number"!=typeof t||"number"!=typeof r)throw new TypeError('Must specify "to" and "from" arguments as numbers');if(t>r){var n=t;t=r,r=n}var a=r-t;if(0===a)return r;return e-a*Math.floor((e-t)/a)};var l=i,h=c,p=Number.EPSILON;function d(e,t,r){return t<r?e<t?t:e>r?r:e:e<r?r:e>t?t:e}function m(e,t,r){return e*(1-r)+t*r}function v(e,t,r){return Math.abs(e-t)<p?0:(r-e)/(t-e)}function y(e,t){return t=l(t,0),"number"==typeof e&&isFinite(e)?e:t}function x(e){if("number"!=typeof e)throw new TypeError("Expected dims argument");return function(t,r){var n;r=l(r,0),null==t?n=r:"number"==typeof t&&isFinite(t)&&(n=t);var a,i=[];if(null==n)for(a=0;a<e;a++)i[a]=y(t[a],r);else for(a=0;a<e;a++)i[a]=n;return i}}function w(e,t,r,n){if(n=n||[],e.length!==t.length)throw new TypeError("min and max array are expected to have the same length");for(var a=0;a<e.length;a++)n[a]=m(e[a],t[a],r);return n}function k(e,t){if("number"!=typeof(e=l(e,0)))throw new TypeError("Expected n argument to be a number");for(var r=[],n=0;n<e;n++)r.push(t);return r}function M(e,t){return(e%t+t)%t}function A(e,t,r,n){return m(e,t,1-Math.exp(-r*n))}var _={mod:M,fract:function(e){return e-Math.floor(e)},sign:function(e){return e>0?1:e<0?-1:0},degToRad:function(e){return e*Math.PI/180},radToDeg:function(e){return 180*e/Math.PI},wrap:h,pingPong:function(e,t){return e=M(e,2*t),t-Math.abs(e-t)},linspace:function(e,t){if("number"!=typeof(e=l(e,0)))throw new TypeError("Expected n argument to be a number");"boolean"==typeof(t=t||{})&&(t={endpoint:!0});var r=l(t.offset,0);return t.endpoint?k(e).map((function(t,n){return e<=1?0:(n+r)/(e-1)})):k(e).map((function(t,n){return(n+r)/e}))},lerp:m,lerpArray:w,inverseLerp:v,lerpFrames:function(e,t,r){t=d(t,0,1);var n=e.length-1,a=t*n,i=Math.floor(a),o=a-i,f=Math.min(i+1,n),u=e[i%e.length],s=e[f%e.length];if("number"==typeof u&&"number"==typeof s)return m(u,s,o);if(Array.isArray(u)&&Array.isArray(s))return w(u,s,o,r);throw new TypeError("Mismatch in value type of two array elements: "+i+" and "+f)},clamp:d,clamp01:function(e){return d(e,0,1)},smoothstep:function(e,t,r){var n=d(v(e,t,r),0,1);return n*n*(3-2*n)},damp:A,dampArray:function(e,t,r,n,a){a=a||[];for(var i=0;i<e.length;i++)a[i]=A(e[i],t[i],r,n);return a},mapRange:function(e,t,r,n,a,i){if(Math.abs(t-r)<p)return n;var o=(e-t)/(r-t)*(a-n)+n;return i&&(a<n?o<a?o=a:o>n&&(o=n):o>a?o=a:o<n&&(o=n)),o},expand2D:x(2),expand3D:x(3),expand4D:x(4)},S={},E={exports:{}},T=i,j=["mm","cm","m","pc","pt","in","ft","px"],D={m:{system:"metric",factor:1},cm:{system:"metric",factor:.01},mm:{system:"metric",factor:.001},pt:{system:"imperial",factor:1/72},pc:{system:"imperial",factor:1/6},in:{system:"imperial",factor:1},ft:{system:"imperial",factor:12}};const C={metric:{unit:"m",ratio:1/.0254},imperial:{unit:"in",ratio:.0254}};E.exports=function(e,t,r,n){if("number"!=typeof e||!isFinite(e))throw new Error("Value must be a finite number");if(!t||!r)throw new Error("Must specify from and to units");var a=T((n=n||{}).pixelsPerInch,96),i=n.precision,o=!1!==n.roundPixel;if(t=t.toLowerCase(),r=r.toLowerCase(),-1===j.indexOf(t))throw new Error('Invalid from unit "'+t+'", must be one of: '+j.join(", "));if(-1===j.indexOf(r))throw new Error('Invalid from unit "'+r+'", must be one of: '+j.join(", "));if(t===r)return e;var f=1,u=1,s=!1;"px"===t&&(u=1/a,t="in"),"px"===r&&(s=!0,f=a,r="in");var c=D[t],l=D[r],h=e*c.factor*u;c.system!==l.system&&(h*=C[c.system].ratio);var p=h/l.factor*f;return s&&o?p=Math.round(p):"number"==typeof i&&isFinite(i)&&(p=function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}(p,i)),p},E.exports.units=j;var O=Math.PI,P=2*O,F=1e-6,z=P-F;function B(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function L(){return new B}B.prototype=L.prototype={constructor:B,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,r,n){this._+="Q"+ +e+","+ +t+","+(this._x1=+r)+","+(this._y1=+n)},bezierCurveTo:function(e,t,r,n,a,i){this._+="C"+ +e+","+ +t+","+ +r+","+ +n+","+(this._x1=+a)+","+(this._y1=+i)},arcTo:function(e,t,r,n,a){e=+e,t=+t,r=+r,n=+n,a=+a;var i=this._x1,o=this._y1,f=r-e,u=n-t,s=i-e,c=o-t,l=s*s+c*c;if(a<0)throw new Error("negative radius: "+a);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(l>F)if(Math.abs(c*f-u*s)>F&&a){var h=r-i,p=n-o,d=f*f+u*u,m=h*h+p*p,b=Math.sqrt(d),v=Math.sqrt(l),g=a*Math.tan((O-Math.acos((d+l-m)/(2*b*v)))/2),y=g/v,x=g/b;Math.abs(y-1)>F&&(this._+="L"+(e+y*s)+","+(t+y*c)),this._+="A"+a+","+a+",0,0,"+ +(c*h>s*p)+","+(this._x1=e+x*f)+","+(this._y1=t+x*u)}else this._+="L"+(this._x1=e)+","+(this._y1=t);else;},arc:function(e,t,r,n,a,i){e=+e,t=+t,i=!!i;var o=(r=+r)*Math.cos(n),f=r*Math.sin(n),u=e+o,s=t+f,c=1^i,l=i?n-a:a-n;if(r<0)throw new Error("negative radius: "+r);null===this._x1?this._+="M"+u+","+s:(Math.abs(this._x1-u)>F||Math.abs(this._y1-s)>F)&&(this._+="L"+u+","+s),r&&(l<0&&(l=l%P+P),l>z?this._+="A"+r+","+r+",0,1,"+c+","+(e-o)+","+(t-f)+"A"+r+","+r+",0,1,"+c+","+(this._x1=u)+","+(this._y1=s):l>F&&(this._+="A"+r+","+r+",0,"+ +(l>=O)+","+c+","+(this._x1=e+r*Math.cos(a))+","+(this._y1=t+r*Math.sin(a))))},rect:function(e,t,r,n){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +r+"v"+ +n+"h"+-r+"Z"},toString:function(){return this._}};var I=t(Object.freeze({__proto__:null,path:L}));function R(e){return[e[0],e[1]]}function q(e,t){return[e,t]}var G=function(e){var t="number"==typeof(e=e||{}).recursion?e.recursion:8,r="number"==typeof e.epsilon?e.epsilon:1.1920929e-7,n="number"==typeof e.pathEpsilon?e.pathEpsilon:1,a="number"==typeof e.angleEpsilon?e.angleEpsilon:.01,i=e.angleTolerance||0,o=e.cuspLimit||0;return function(e,t,r,a,i,o){o||(o=[]);var u=n/(i="number"==typeof i?i:1);return function(e,t,r,n,a,i){a.push(R(e));var o=e[0],u=e[1],s=t[0],c=t[1],l=r[0],h=r[1],p=n[0],d=n[1];f(o,u,s,c,l,h,p,d,a,i,0),a.push(R(n))}(e,t,r,a,o,u*=u),o};function f(e,n,u,s,c,l,h,p,d,m,b){if(!(b>t)){var v=Math.PI,g=(e+u)/2,y=(n+s)/2,x=(u+c)/2,w=(s+l)/2,k=(c+h)/2,M=(l+p)/2,A=(g+x)/2,_=(y+w)/2,S=(x+k)/2,E=(w+M)/2,T=(A+S)/2,j=(_+E)/2;if(b>0){var D,C,O=h-e,P=p-n,F=Math.abs((u-h)*P-(s-p)*O),z=Math.abs((c-h)*P-(l-p)*O);if(F>r&&z>r){if((F+z)*(F+z)<=m*(O*O+P*P)){if(i<a)return void d.push(q(T,j));var B=Math.atan2(l-s,c-u);if((D=Math.abs(B-Math.atan2(s-n,u-e)))>=v&&(D=2*v-D),(C=Math.abs(Math.atan2(p-l,h-c)-B))>=v&&(C=2*v-C),D+C<i)return void d.push(q(T,j));if(0!==o){if(D>o)return void d.push(q(u,s));if(C>o)return void d.push(q(c,l))}}}else if(F>r){if(F*F<=m*(O*O+P*P)){if(i<a)return void d.push(q(T,j));if((D=Math.abs(Math.atan2(l-s,c-u)-Math.atan2(s-n,u-e)))>=v&&(D=2*v-D),D<i)return d.push(q(u,s)),void d.push(q(c,l));if(0!==o&&D>o)return void d.push(q(u,s))}}else if(z>r){if(z*z<=m*(O*O+P*P)){if(i<a)return void d.push(q(T,j));if((D=Math.abs(Math.atan2(p-l,h-c)-Math.atan2(l-s,c-u)))>=v&&(D=2*v-D),D<i)return d.push(q(u,s)),void d.push(q(c,l));if(0!==o&&D>o)return void d.push(q(c,l))}}else if((O=T-(e+h)/2)*O+(P=j-(n+p)/2)*P<=m)return void d.push(q(T,j))}f(e,n,g,y,A,_,T,j,d,m,b+1),f(T,j,S,E,k,M,h,p,d,m,b+1)}}}(),H=function(e){var t=0,r=0,n=0,a=0;return e.map((function(e){var i=(e=e.slice())[0],o=i.toUpperCase();if(i!=o)switch(e[0]=o,i){case"a":e[6]+=n,e[7]+=a;break;case"v":e[1]+=a;break;case"h":e[1]+=n;break;default:for(var f=1;f<e.length;)e[f++]+=n,e[f++]+=a}switch(o){case"Z":n=t,a=r;break;case"H":n=e[1];break;case"V":a=e[1];break;case"M":n=t=e[1],a=r=e[2];break;default:n=e[e.length-2],a=e[e.length-1]}return e}))};var N=Math.PI,U=X(120),W=function(e){for(var t,r=[],n=0,a=0,i=0,o=0,f=null,u=null,s=0,c=0,l=0,h=e.length;l<h;l++){var p=e[l],d=p[0];switch(d){case"M":i=p[1],o=p[2];break;case"A":(p=Y(s,c,p[1],p[2],X(p[3]),p[4],p[5],p[6],p[7])).unshift("C"),p.length>7&&(r.push(p.splice(0,7)),p.unshift("C"));break;case"S":var m=s,b=c;"C"!=t&&"S"!=t||(m+=m-n,b+=b-a),p=["C",m,b,p[1],p[2],p[3],p[4]];break;case"T":"Q"==t||"T"==t?(f=2*s-f,u=2*c-u):(f=s,u=c),p=Q(s,c,f,u,p[1],p[2]);break;case"Q":f=p[1],u=p[2],p=Q(s,c,p[1],p[2],p[3],p[4]);break;case"L":p=V(s,c,p[1],p[2]);break;case"H":p=V(s,c,p[1],c);break;case"V":p=V(s,c,s,p[1]);break;case"Z":p=V(s,c,i,o)}t=d,s=p[p.length-2],c=p[p.length-1],p.length>4?(n=p[p.length-4],a=p[p.length-3]):(n=s,a=c),r.push(p)}return r};function V(e,t,r,n){return["C",e,t,r,n,r,n]}function Q(e,t,r,n,a,i){return["C",e/3+2/3*r,t/3+2/3*n,a/3+2/3*r,i/3+2/3*n,a,i]}function Y(e,t,r,n,a,i,o,f,u,s){if(s)y=s[0],x=s[1],v=s[2],g=s[3];else{var c=$(e,t,-a);e=c.x,t=c.y;var l=(e-(f=(c=$(f,u,-a)).x))/2,h=(t-(u=c.y))/2,p=l*l/(r*r)+h*h/(n*n);p>1&&(r*=p=Math.sqrt(p),n*=p);var d=r*r,m=n*n,b=(i==o?-1:1)*Math.sqrt(Math.abs((d*m-d*h*h-m*l*l)/(d*h*h+m*l*l)));b==1/0&&(b=1);var v=b*r*h/n+(e+f)/2,g=b*-n*l/r+(t+u)/2,y=Math.asin(((t-g)/n).toFixed(9)),x=Math.asin(((u-g)/n).toFixed(9));(y=e<v?N-y:y)<0&&(y=2*N+y),(x=f<v?N-x:x)<0&&(x=2*N+x),o&&y>x&&(y-=2*N),!o&&x>y&&(x-=2*N)}if(Math.abs(x-y)>U){var w=x,k=f,M=u;x=y+U*(o&&x>y?1:-1);var A=Y(f=v+r*Math.cos(x),u=g+n*Math.sin(x),r,n,a,0,o,k,M,[x,w,v,g])}var _=Math.tan((x-y)/4),S=4/3*r*_,E=4/3*n*_,T=[2*e-(e+S*Math.sin(y)),2*t-(t-E*Math.cos(y)),f+S*Math.sin(x),u-E*Math.cos(x),f,u];if(s)return T;A&&(T=T.concat(A));for(var j=0;j<T.length;){var D=$(T[j],T[j+1],a);T[j++]=D.x,T[j++]=D.y}return T}function $(e,t,r){return{x:e*Math.cos(r)-t*Math.sin(r),y:e*Math.sin(r)+t*Math.cos(r)}}function X(e){return e*(N/180)}var J=G,Z=H,K=W,ee=function(e,t){return e[0]=t[0],e[1]=t[1],e};function te(e,t,r){return e[0]=t,e[1]=r,e}var re=[0,0],ne=[0,0],ae=[0,0];var ie=function(e){var t=[];return e.replace(fe,(function(e,r,n){var a=r.toLowerCase();for(n=function(e){var t=e.match(ue);return t?t.map(Number):[]}(n),"m"==a&&n.length>2&&(t.push([r].concat(n.splice(0,2))),a="l",r="m"==r?"l":"L");;){if(n.length==oe[a])return n.unshift(r),t.push(n);if(n.length<oe[a])throw new Error("malformed path data");t.push([r].concat(n.splice(0,oe[a])))}})),t},oe={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},fe=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var ue=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;var se=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,f=e[Symbol.iterator]();!(n=(o=f.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&f.return&&f.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},ce=2*Math.PI,le=function(e,t,r,n,a,i,o){var f=e.x,u=e.y;return{x:n*(f*=t)-a*(u*=r)+i,y:a*f+n*u+o}},he=function(e,t){var r=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:4/3*Math.tan(t/4),n=Math.cos(e),a=Math.sin(e),i=Math.cos(e+t),o=Math.sin(e+t);return[{x:n-a*r,y:a+n*r},{x:i+o*r,y:o-i*r},{x:i,y:o}]},pe=function(e,t,r,n){var a=e*r+t*n;return a>1&&(a=1),a<-1&&(a=-1),(e*n-t*r<0?-1:1)*Math.acos(a)},de=function(e){for(var t,r=[],n=0,a=0,i=0,o=0,f=null,u=null,s=0,c=0,l=0,h=e.length;l<h;l++){var p=e[l],d=p[0];switch(d){case"M":i=p[1],o=p[2];break;case"A":var m=me({px:s,py:c,cx:p[6],cy:p[7],rx:p[1],ry:p[2],xAxisRotation:p[3],largeArcFlag:p[4],sweepFlag:p[5]});if(!m.length)continue;for(var b,v=0;v<m.length;v++)b=m[v],p=["C",b.x1,b.y1,b.x2,b.y2,b.x,b.y],v<m.length-1&&r.push(p);break;case"S":var g=s,y=c;"C"!=t&&"S"!=t||(g+=g-n,y+=y-a),p=["C",g,y,p[1],p[2],p[3],p[4]];break;case"T":"Q"==t||"T"==t?(f=2*s-f,u=2*c-u):(f=s,u=c),p=ve(s,c,f,u,p[1],p[2]);break;case"Q":f=p[1],u=p[2],p=ve(s,c,p[1],p[2],p[3],p[4]);break;case"L":p=be(s,c,p[1],p[2]);break;case"H":p=be(s,c,p[1],c);break;case"V":p=be(s,c,s,p[1]);break;case"Z":p=be(s,c,i,o)}t=d,s=p[p.length-2],c=p[p.length-1],p.length>4?(n=p[p.length-4],a=p[p.length-3]):(n=s,a=c),r.push(p)}return r},me=t(Object.freeze({__proto__:null,default:function(e){var t=e.px,r=e.py,n=e.cx,a=e.cy,i=e.rx,o=e.ry,f=e.xAxisRotation,u=void 0===f?0:f,s=e.largeArcFlag,c=void 0===s?0:s,l=e.sweepFlag,h=void 0===l?0:l,p=[];if(0===i||0===o)return[];var d=Math.sin(u*ce/360),m=Math.cos(u*ce/360),b=m*(t-n)/2+d*(r-a)/2,v=-d*(t-n)/2+m*(r-a)/2;if(0===b&&0===v)return[];i=Math.abs(i),o=Math.abs(o);var g=Math.pow(b,2)/Math.pow(i,2)+Math.pow(v,2)/Math.pow(o,2);g>1&&(i*=Math.sqrt(g),o*=Math.sqrt(g));var y=function(e,t,r,n,a,i,o,f,u,s,c,l){var h=Math.pow(a,2),p=Math.pow(i,2),d=Math.pow(c,2),m=Math.pow(l,2),b=h*p-h*m-p*d;b<0&&(b=0),b/=h*m+p*d;var v=(b=Math.sqrt(b)*(o===f?-1:1))*a/i*l,g=b*-i/a*c,y=s*v-u*g+(e+r)/2,x=u*v+s*g+(t+n)/2,w=(c-v)/a,k=(l-g)/i,M=(-c-v)/a,A=(-l-g)/i,_=pe(1,0,w,k),S=pe(w,k,M,A);return 0===f&&S>0&&(S-=ce),1===f&&S<0&&(S+=ce),[y,x,_,S]}(t,r,n,a,i,o,c,h,d,m,b,v),x=se(y,4),w=x[0],k=x[1],M=x[2],A=x[3],_=Math.abs(A)/(ce/4);Math.abs(1-_)<1e-7&&(_=1);var S=Math.max(Math.ceil(_),1);A/=S;for(var E=0;E<S;E++)p.push(he(M,A)),M+=A;return p.map((function(e){var t=le(e[0],i,o,m,d,w,k),r=t.x,n=t.y,a=le(e[1],i,o,m,d,w,k),f=a.x,u=a.y,s=le(e[2],i,o,m,d,w,k);return{x1:r,y1:n,x2:f,y2:u,x:s.x,y:s.y}}))}}));function be(e,t,r,n){return["C",e,t,r,n,r,n]}function ve(e,t,r,n,a,i){return["C",e/3+2/3*r,t/3+2/3*n,a/3+2/3*r,i/3+2/3*n,a,i]}var ge={},ye={exports:{}};!function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,r,n;try{t=Map}catch(e){t=function(){}}try{r=Set}catch(e){r=function(){}}try{n=Promise}catch(e){n=function(){}}function a(i,f,u,s,c){"object"==typeof f&&(u=f.depth,s=f.prototype,c=f.includeNonEnumerable,f=f.circular);var l=[],h=[],p="undefined"!=typeof Buffer;return void 0===f&&(f=!0),void 0===u&&(u=1/0),function i(u,d){if(null===u)return null;if(0===d)return u;var m,b;if("object"!=typeof u)return u;if(e(u,t))m=new t;else if(e(u,r))m=new r;else if(e(u,n))m=new n((function(e,t){u.then((function(t){e(i(t,d-1))}),(function(e){t(i(e,d-1))}))}));else if(a.__isArray(u))m=[];else if(a.__isRegExp(u))m=new RegExp(u.source,o(u)),u.lastIndex&&(m.lastIndex=u.lastIndex);else if(a.__isDate(u))m=new Date(u.getTime());else{if(p&&Buffer.isBuffer(u))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(u.length):new Buffer(u.length),u.copy(m),m;e(u,Error)?m=Object.create(u):void 0===s?(b=Object.getPrototypeOf(u),m=Object.create(b)):(m=Object.create(s),b=s)}if(f){var v=l.indexOf(u);if(-1!=v)return h[v];l.push(u),h.push(m)}for(var g in e(u,t)&&u.forEach((function(e,t){var r=i(t,d-1),n=i(e,d-1);m.set(r,n)})),e(u,r)&&u.forEach((function(e){var t=i(e,d-1);m.add(t)})),u){var y;b&&(y=Object.getOwnPropertyDescriptor(b,g)),y&&null==y.set||(m[g]=i(u[g],d-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(u);for(g=0;g<x.length;g++){var w=x[g];(!(M=Object.getOwnPropertyDescriptor(u,w))||M.enumerable||c)&&(m[w]=i(u[w],d-1),M.enumerable||Object.defineProperty(m,w,{enumerable:!1}))}}if(c){var k=Object.getOwnPropertyNames(u);for(g=0;g<k.length;g++){var M,A=k[g];(M=Object.getOwnPropertyDescriptor(u,A))&&M.enumerable||(m[A]=i(u[A],d-1),Object.defineProperty(m,A,{enumerable:!1}))}}return m}(i,u)}function i(e){return Object.prototype.toString.call(e)}function o(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return a.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},a.__objToStr=i,a.__isDate=function(e){return"object"==typeof e&&"[object Date]"===i(e)},a.__isArray=function(e){return"object"==typeof e&&"[object Array]"===i(e)},a.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===i(e)},a.__getRegExpFlags=o,a}();e.exports&&(e.exports=t)}(ye);var xe={};xe.squaredDistance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n};var we=ye.exports,ke=xe.squaredDistance;function Me(e,t,r){var n=Math.min(t,r),a=Math.max(t,r),i=(e=e.slice())[n],o=e[a],f=i.concat(o.slice(1));return e.splice(a,1),e.splice(n,1,f),e}ge.sort=function(e){if(!(e=we(e)).length)return e;var t=[];for(t.push(e[0]),e=e.slice(1);e.length;){var r=t[t.length-1],n=r[r.length-1],a=e.reduce((function(e,t,r){var a=t[0],i=t[t.length-1],o=ke(n,a),f=ke(n,i);return e?o<e.distance?{idx:r,distance:o,reverse:!1}:f<e.distance?{idx:r,distance:f,reverse:!0}:e:{idx:r,distance:Math.min(o,f),reverse:f<o}}),null),i=a.idx,o=a.reverse,f=e.splice(i,1)[0].slice();o&&f.reverse(),t.push(f)}return t},ge.merge=function(e,t){var r=(t=null!=t?t:.05)*t;e=we(e);for(var n=1;n<e.length;n++){var a=e[n-1],i=e[n];ke(i[0],a[a.length-1])<r&&(e=Me(e,n-1,n),n-=1)}return e};var Ae={exports:{}},_e=Se;function Se(e,t,r){var n,a,i,o,f,u=e.length,s=Te(e[0],t),c=[];for(r||(r=[]),n=1;n<u;n++){for(a=e[n-1],o=f=Te(i=e[n],t);;){if(!(s|o)){c.push(a),o!==f?(c.push(i),n<u-1&&(r.push(c),c=[])):n===u-1&&c.push(i);break}if(s&o)break;s?s=Te(a=Ee(a,i,s,t),t):o=Te(i=Ee(a,i,o,t),t)}s=f}return c.length&&r.push(c),r}function Ee(e,t,r,n){return 8&r?[e[0]+(t[0]-e[0])*(n[3]-e[1])/(t[1]-e[1]),n[3]]:4&r?[e[0]+(t[0]-e[0])*(n[1]-e[1])/(t[1]-e[1]),n[1]]:2&r?[n[2],e[1]+(t[1]-e[1])*(n[2]-e[0])/(t[0]-e[0])]:1&r?[n[0],e[1]+(t[1]-e[1])*(n[0]-e[0])/(t[0]-e[0])]:null}function Te(e,t){var r=0;return e[0]<t[0]?r|=1:e[0]>t[2]&&(r|=2),e[1]<t[1]?r|=4:e[1]>t[3]&&(r|=8),r}Se.polyline=Se,Se.polygon=function(e,t){var r,n,a,i,o,f,u;for(n=1;n<=8;n*=2){for(r=[],a=e[e.length-1],i=!(Te(a,t)&n),o=0;o<e.length;o++)f=e[o],(u=!(Te(f,t)&n))!==i&&r.push(Ee(a,f,n,t)),u&&r.push(f),a=f,i=u;if(!(e=r).length)break}return r};var je=Math.abs,De=Math.min;function Ce(e,t,r,n){var a=je(e-t);return null==r&&(r=Ce.DBL_EPSILON),null==n&&(n=r),a<=r||(a<=n*De(je(e),je(t))||e===t)}Ce.FLT_EPSILON=1.1920929e-7,Ce.DBL_EPSILON=2220446049250313e-31;var Oe=Ce,Pe=Object.prototype.toString,Fe=function(e){return e.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===Pe.call(e.buffer)||Array.isArray(e)};var ze=Math.abs,Be=Math.min;function Le(e,t,r,n){var a=ze(e-t);return a<=r||(a<=n*Be(ze(e),ze(t))||e===t)}Le.FLT_EPSILON=1.1920929e-7,Le.DBL_EPSILON=2220446049250313e-31;var Ie=Fe,Re=Le,qe=function(e,t,r,n){return!!(e&&t&&Ie(e)&&Ie(t))&&(e.length===t.length&&("number"!=typeof r&&(r=Re.FLT_EPSILON),"number"!=typeof n&&(n=r),Array.prototype.slice.call(e).every((function(e,a){var i=t[a];return e===i||Re(e,i,r,n)}))))},Ge=Oe,He=function(e,t,r,n,a){return function(e,t,r,n,a,i,o,f){null==f&&(f=[]);var u,s,c,l,h,p=Ne(e,t,a,i,o),d=Ne(r,n,a,i,o);if(p&&d)return f.push([e,t]),f.push([r,n]),!0;if(p||d){c=function(e,t,r,n,a,i){var o=r-e,f=n-t,u=(o*(a-e)+f*(i-t))/(o*o+f*f);return[e+u*o,t+u*f]}(e,t,r,n,a,i),u=Ue(l=c[0],h=c[1],a,i),s=Math.sqrt(o*o-u*u);var m=p?[e,t]:[r,n],b=p?We(l,h,r,n,s):We(l,h,e,t,s);return Ge(m[0],b[0])&&Ge(m[1],b[1])?(f.push(m),!0):(f.push(m),f.push(b),!0)}return c=function(e,t,r,n,a,i){var o=r-e,f=n-t,u=o*(a-e)+f*(i-t);if(u<=0)return[e,t];var s=o*o+f*f;if(s<=u)return[r,n];var c=u/s;return[e+c*o,t+c*f]}(e,t,r,n,a,i),l=c[0],h=c[1],!(Ge(e,l)&&Ge(t,h)||Ge(r,l)&&Ge(n,h))&&(!((u=Ue(l,h,a,i))>o)&&(Ge(u,o)?(f.push([l,h]),!0):Ge(u,0)?(f.push(We(a,i,e,t,o)),f.push(We(a,i,r,n,o)),!0):(s=Math.sqrt(o*o-u*u),f.push(We(l,h,e,t,s)),f.push(We(l,h,r,n,s)),!0)))}(e[0],e[1],t[0],t[1],r[0],r[1],n,a)};function Ne(e,t,r,n,a){return(i=r-e)*i+(o=n-t)*o<=a*a;var i,o}function Ue(e,t,r,n){var a=e-r,i=t-n;return Math.sqrt(a*a+i*i)}function We(e,t,r,n,a){var i=a/Ue(e,t,r,n);return[e+i*(r-e),t+i*(n-t)]}var Ve=Oe,Qe=function(e,t,r,n,a){null==a&&(a=[]);var i,o=Ye(t[0]-e[0])+Ye(t[1]-e[1]),f=2*((t[0]-e[0])*(e[0]-r[0])+(t[1]-e[1])*(e[1]-r[1])),u=Ye(r[0])+Ye(r[1])+Ye(e[0])+Ye(e[1])-2*(r[0]*e[0]+r[1]*e[1])-Ye(n),s=f*f-4*o*u;if(s<0)return!1;if(Ve(s,0))return i=-f/(2*o),a.push([e[0]+i*(t[0]-e[0]),e[1]+i*(t[1]-e[1])]),!0;if(s>0){var c=Math.sqrt(s);return i=(-f+c)/(2*o),a.push([e[0]+i*(t[0]-e[0]),e[1]+i*(t[1]-e[1])]),i=(-f-c)/(2*o),a.push([e[0]+i*(t[0]-e[0]),e[1]+i*(t[1]-e[1])]),!0}return null};function Ye(e){return e*e}!function(e){var t=_e,r=Oe,n=qe,a=ye.exports,i=xe.squaredDistance;e.exports.arePointsCollinear=function(e,t,n){var a=e[0],i=e[1],o=t[0],f=t[1],u=n[0],s=n[1];return r((i-f)*(a-u),(i-s)*(a-o))},e.exports.removeDuplicatePoints=function(e){for(var t,r=[],i=0;i<e.length;i++){var o=e[i];t&&n(t,o)||(r.push(o),t=o)}return a(r)},e.exports.removeCollinearPoints=function(t){for(var r=[],n=a(t);n.length>=3;){var o=n[0],f=n[1],u=n[2],s=e.exports.arePointsCollinear(o,f,u);if(s)i(o,f)>i(o,u)&&(s=!1);if(s)n.splice(1,1);else for(var c=0;c<1;c++)r.push(n.shift())}for(;n.length;)r.push(n.shift());return r},e.exports.clipSegmentToCircle=He,e.exports.clipLineToCircle=Qe,e.exports.clipPolylinesToBox=function(e,r,n,a){if(!Array.isArray(r)||2!==r.length&&4!==r.length)throw new Error("Expected box to either be format [ minPoint, maxPoint ] or [ minX, minY, maxX, maxY ]");if(2===r.length){var i=r[0],o=r[1];r=[i[0],i[1],o[0],o[1]]}return a=!1!==a,(n=Boolean(n))?e.map((function(e){var n=t.polygon(e,r);return a&&n.length>2&&n.push(n[0]),n})).filter((function(e){return e.length>0})):e.map((function(e){return t.polyline(e,r)})).reduce((function(e,t){return e.concat(t)}),[])},e.exports.createHatchLines=function(e,t,r,n){if(!Array.isArray(e)||2!==e.length&&4!==e.length)throw new Error("Expected box to either be format [ minPoint, maxPoint ] or [ minX, minY, maxX, maxY ]");if(2===e.length){var a=e[0],i=e[1];e=[a[0],a[1],i[0],i[1]]}null==t&&(t=-Math.PI/4);null==r&&(r=.5);null==n&&(n=[]);if(0===(r=Math.abs(r)))throw new Error("cannot use a spacing of zero as it will run an infinite loop!");var o=e[0],f=e[1],u=e[2],s=e[3],c=u-o,l=s-f;if(0===c||0===l)return n;var h=Math.sqrt(c*c+l*l)/2,p=Math.PI/2-t,d=Math.cos(p),m=Math.sin(p),b=o+c/2,v=f+l/2,g=-h;for(;g<=h;){var y=b+g*d+h*m,x=v+g*m-h*d,w=b+g*d-h*m,k=v+g*m+h*d;g+=r,y<o&&w<o||y>u&&w>u||(x<f&&k<f||x>s&&k>s||n.push([[y,x],[w,k]]))}return n},e.exports.getBounds=function(e){var t=e.length;if(0===t)throw new Error("Expected points to be a non-empty array");for(var r=e[0].length,n=e[0].slice(),a=e[0].slice(),i=1;i<t;++i)for(var o=e[i],f=0;f<r;++f){var u=o[f];n[f]=Math.min(n[f],u),a[f]=Math.max(a[f],u)}return[n,a]}}(Ae);var $e=i,Xe=E.exports,Je=I,Ze=function(e,t){var r=[],n=[],a=[0,0];return K(Z(e)).forEach((function(e,i,o){if("M"===e[0])ee(a,e.slice(1)),n.length>0&&(r.push(n),n=[]);else{if("C"!==e[0])throw new Error("illegal type in SVG: "+e[0]);!function(e,t,r,n){J(r,te(re,n[1],n[2]),te(ne,n[3],n[4]),te(ae,n[5],n[6]),t,e)}(n,t,a,e),te(a,e[5],e[6])}})),n.length>0&&r.push(n),r},Ke=ie,et=H,tt=de,rt=ge,nt=Ae.exports;function at(e,t){var r=st(e,t=t||{});return(Array.isArray(r)?r:[r]).filter(Boolean)}function it(e,t){var r;if(null!=(t=t||{}).curveResolution&&isFinite(t.curveResolution)&&"number"==typeof t.curveResolution)r=t.curveResolution;else{var n=t.units||"px";r=Math.max(1,Xe(4,n,"px"))}var a=[];return ct(e,(function(e){if("string"==typeof e){var t=Ke(e);Ze(t,r).forEach((function(e){a.push(e)}))}else{var n=e.map((function(e){return[e[0]||0,e[1]||0]}));a.push(n)}})),a}function ot(e,t){var r=(t=t||{}).width,n=t.height;if(void 0===r||void 0===n)throw new Error('Must specify "width" and "height" options');var a="px",i=t.units||a,o={units:i,viewUnits:"px",roundPixel:!1,precision:$e(t.precision,5),pixelsPerInch:90};if(e=it(e,Object.assign({},o,{curveResolution:t.curveResolution||void 0})),t.optimize){var f="object"==typeof t.optimize?t.optimize:{sort:!0,merge:!0,removeDuplicates:!0,removeCollinear:!0},u=!1!==f.sort,s=!1!==f.merge,c=!1!==f.removeDuplicates,l=!1!==f.removeCollinear;if(c&&(e=e.map((function(e){return nt.removeDuplicatePoints(e)}))),l&&(e=e.map((function(e){return nt.removeCollinearPoints(e)}))),u&&(e=rt.sort(e)),s){var h=null!=f.mergeThreshold?f.mergeThreshold:Xe(.25,"mm",i,{pixelsPerInch:90});e=rt.merge(e,h)}}var p=at(e,o),d=Xe(r,i,a,o).toString(),m=Xe(n,i,a,o).toString(),b=t.fillStyle||"none",v=t.strokeStyle||"black",g=t.lineWidth,y=t.lineJoin,x=t.lineCap;void 0===g&&(g=Xe(.03,"cm",i,o).toString());var w=p.map((function(e){return"    <path "+ft([["d",e]])+" />"})).join("\n");return['<?xml version="1.0" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','    "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">','<svg width="'+r+i+'" height="'+n+i+'"','    xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 '+d+" "+m+'">',"  <g "+ft([["fill",b],["stroke",v],["stroke-width",g+""+i],!!y&&["stroke-linejoin",y],!!x&&["stroke-linecap",x]])+">",w,"  </g>","</svg>"].join("\n")}function ft(e){return e.filter(Boolean).map((function(e){return e[0]+'="'+e[1]+'"'})).join(" ")}function ut(e,t){var r=(t=t||{}).context;if(!r)throw new Error('Must specify "context" options');var n=t.units||"px",a=t.width,i=t.height;if(void 0===a||void 0===i)throw new Error('Must specify "width" and "height" options');var o=t.lineWidth;return void 0===o&&(o=Xe(.03,"cm",n,{roundPixel:!1,pixelsPerInch:90})),r.clearRect(0,0,a,i),r.fillStyle=t.background||"white",r.fillRect(0,0,a,i),r.strokeStyle=t.foreground||t.strokeStyle||"black",r.lineWidth=o,r.lineJoin=t.lineJoin||"miter",r.lineCap=t.lineCap||"butt",ct(e,(function(e){r.beginPath(),"string"==typeof e?lt(r,e):e.forEach((function(e){r.lineTo(e[0],e[1])})),r.stroke()})),[r.canvas,{data:ot(e,t),extension:".svg"}]}function st(e,t){return pt(e)?"":"string"==typeof e?e:dt(e)?e.toString():mt(e)?ht(e,t):Array.isArray(e)?e.map((function(e){return st(e,t)})).reduce((function(e,t){return e.concat(t)}),[]):""}function ct(e,t){pt(e)||("string"==typeof e||dt(e)?t(e.toString()):mt(e)?t(e):Array.isArray(e)&&e.forEach((function(e){return ct(e,t)})))}function lt(e,t){for(var r=tt(et(Ke(t))),n=0;n<r.length;n++){var a=r[n],i=a[0];if("M"===i)e.moveTo(a[1],a[2]);else{if("C"!==i)throw new Error('Illegal type "'+i+'" in SVG commands');e.bezierCurveTo(a[1],a[2],a[3],a[4],a[5],a[6])}}}function ht(e,t){var r=(t=t||{}).units||"px",n=t.viewUnits||r,a=[],i={roundPixel:!1,precision:$e(t.precision,5),pixelsPerInch:90};return e.forEach((function(e,t){var o=0===t?"M":"L",f=Xe(e[0],r,n,i).toString(),u=Xe(e[1],r,n,i).toString();a.push(o+f+" "+u)})),a.join(" ")}function pt(e){return!e||Array.isArray(e)&&0===e.length}function dt(e){return"object"==typeof e&&e&&!Array.isArray(e)}function mt(e){return!(!e||!Array.isArray(e)||0===e.length)&&(t=e[0],Array.isArray(t)&&t.length>=2&&t.every((function(e){return"number"==typeof e})));var t}S.createPath=function(e){var t=Je.path();"function"==typeof e&&e(t);return t.lineTo=r(t.lineTo),t.quadraticCurveTo=r(t.quadraticCurveTo),t.bezierCurveTo=r(t.bezierCurveTo),t;function r(e){return function(){var r=Array.prototype.slice.call(arguments);return null==t._x1&&null==t._y1&&t.moveTo(r[0],r[1]),e.apply(t,r)}}},S.pathsToSVGPaths=at,S.pathsToPolylines=it,S.pathsToSVG=ot,S.renderPaths=ut,S.convertToSVGPath=st,S.eachPath=ct,S.drawSVGPath=lt,S.polylineToSVGPath=ht,S.polylinesToSVG=function(e,t){if(!Array.isArray(e))throw new Error("Expected array of arrays for polylines");return console.warn("polylinesToSVG is deprecated, use pathsToSVG instead which has the same functionality"),ot(e,t)},S.renderPolylines=function(e,t){if(!Array.isArray(e))throw new Error("Expected array of arrays for polylines");return console.warn("renderPolylines is deprecated, use renderPaths instead which has the same functionality"),ut(e,t)};var bt={exports:{}};!function(e,t){e.exports=function(){var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e},r="\n";function n(e){return"undefined"!=typeof atob?atob(e):"base64:"+e}function a(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||a(t)}function o(e){return e?": "+e:""}function f(e,t,r){e in t||a("unknown parameter ("+e+")"+o(r)+". possible values: "+Object.keys(t).join())}function u(t,r){e(t)||a("invalid parameter type"+o(r)+". must be a typed array")}function s(e,t,r){typeof e!==t&&a("invalid parameter type"+o(r)+". expected "+t+", got "+typeof e)}function c(e,t){e>=0&&(0|e)===e||a("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")}function l(e,t,r){t.indexOf(e)<0&&a("invalid value"+o(r)+". must be one of: "+t)}var h=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function p(e){Object.keys(e).forEach((function(e){h.indexOf(e)<0&&a('invalid regl constructor argument "'+e+'". must be one of '+h)}))}function d(e,t){for(e+="";e.length<t;)e=" "+e;return e}function m(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function b(e,t){this.number=e,this.line=t,this.errors=[]}function v(e,t,r){this.file=e,this.line=t,this.message=r}function g(){var e=new Error,t=(e.stack||e).toString(),r=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return n?n[1]:"unknown"}function y(){var e=new Error,t=(e.stack||e).toString(),r=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return n?n[1]:"unknown"}function x(e,t){var r=e.split("\n"),a=1,i=0,o={unknown:new m,0:new m};o.unknown.name=o[0].name=t||g(),o.unknown.lines.push(new b(0,""));for(var f=0;f<r.length;++f){var u=r[f],s=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(u);if(s)switch(s[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(s[2]);c&&(a=0|c[1],c[2]&&((i=0|c[2])in o||(o[i]=new m)));break;case"define":var l=/SHADER_NAME(_B64)?\s+(.*)$/.exec(s[2]);l&&(o[i].name=l[1]?n(l[2]):l[2])}o[i].lines.push(new b(a++,u))}return Object.keys(o).forEach((function(e){var t=o[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),o}function w(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var r=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(e);r?t.push(new v(0|r[1],0|r[2],r[3].trim())):e.length>0&&t.push(new v("unknown",0,e))}})),t}function k(e,t){t.forEach((function(t){var r=e[t.file];if(r){var n=r.index[t.line];if(n)return n.errors.push(t),void(r.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}function M(e,t,n,a,o){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var f=e.getShaderInfoLog(t),u=a===e.FRAGMENT_SHADER?"fragment":"vertex";D(n,"string",u+" shader source must be a string",o);var s=x(n,o),c=w(f);k(s,c),Object.keys(s).forEach((function(e){var t=s[e];if(t.hasErrors){var n=[""],a=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){i(d(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+r,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(n){var a=n.message,o=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(a);if(o){var f=o[1];a=o[2],"assign"===f&&(f="="),t=Math.max(e.line.indexOf(f,t),0)}else t=0;i(d("| ",6)),i(d("^^^",t+3)+r,"font-weight:bold"),i(d("| ",6)),i(a+r,"font-weight:bold")})),i(d("| ",6)+r)}else i(d(e.number,4)+"|  "),i(e.line+r,"color:red")})),"undefined"==typeof document||window.chrome?console.log(n.join("")):(a[0]=n.join("%c"),console.log.apply(console,a))}function i(e,t){n.push(e),a.push(t||"")}})),i.raise("Error compiling "+u+" shader, "+s[0].name)}}function A(e,t,n,a,o){if(!e.getProgramParameter(t,e.LINK_STATUS)){var f=e.getProgramInfoLog(t),u=x(n,o),s='Error linking program with vertex shader, "'+x(a,o)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+s+r+"%c"+f,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(s+r+f),i.raise(s)}}function _(e){e._commandRef=g()}function S(e,t,r,n){function a(e){return e?n.id(e):0}function i(e,t){Object.keys(t).forEach((function(t){e[n.id(t)]=!0}))}_(e),e._fragId=a(e.static.frag),e._vertId=a(e.static.vert);var o=e._uniformSet={};i(o,t.static),i(o,t.dynamic);var f=e._attributeSet={};i(f,r.static),i(f,r.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function E(e,t){var r=y();a(e+" in command "+(t||g())+("unknown"===r?"":" called from "+r))}function T(e,t,r){e||E(t,r||g())}function j(e,t,r,n){e in t||E("unknown parameter ("+e+")"+o(r)+". possible values: "+Object.keys(t).join(),n||g())}function D(e,t,r,n){typeof e!==t&&E("invalid parameter type"+o(r)+". expected "+t+", got "+typeof e,n||g())}function C(e){e()}function O(e,t,r){e.texture?l(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):l(e.renderbuffer._renderbuffer.format,r,"unsupported renderbuffer format for attachment")}var P=33071,F=9728,z=9984,B=9985,L=9986,I=9987,R=5121,q=5122,G=5123,H=5124,N=5125,U=5126,W=32819,V=32820,Q=33635,Y=34042,$=36193,X={};function J(e,t){return e===V||e===W||e===Q?2:e===Y?4:X[e]*t}function Z(e){return!(e&e-1||!e)}function K(e,t,r){var n,a=t.width,o=t.height,f=t.channels;i(a>0&&a<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),e.wrapS===P&&e.wrapT===P||i(Z(a)&&Z(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==a&&1!==o&&i(e.minFilter!==z&&e.minFilter!==L&&e.minFilter!==B&&e.minFilter!==I,"min filter requires mipmap"):(i(Z(a)&&Z(o),"texture must be a square power of 2 to support mipmapping"),i(t.mipmask===(a<<1)-1,"missing or incomplete mipmap data")),t.type===U&&(r.extensions.indexOf("oes_texture_float_linear")<0&&i(e.minFilter===F&&e.magFilter===F,"filter not supported, must enable oes_texture_float_linear"),i(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(n=0;n<16;++n)if(u[n]){var s=a>>n,c=o>>n;i(t.mipmask&1<<n,"missing mipmap data");var l=u[n];if(i(l.width===s&&l.height===c,"invalid shape for mip images"),i(l.format===t.format&&l.internalformat===t.internalformat&&l.type===t.type,"incompatible type for mip image"),l.compressed);else if(l.data){var h=Math.ceil(J(l.type,f)*s/l.unpackAlignment)*l.unpackAlignment;i(l.data.byteLength===h*c,"invalid data for image, buffer size is inconsistent with image format")}else l.element||l.copy}else e.genMipmaps||i(0==(t.mipmask&1<<n),"extra mipmap data");t.compressed&&i(!e.genMipmaps,"mipmap generation for compressed images not supported")}function ee(e,t,r,n){var a=e.width,o=e.height,f=e.channels;i(a>0&&a<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),i(a===o,"cube map must be square"),i(t.wrapS===P&&t.wrapT===P,"wrap mode not supported by cube map");for(var u=0;u<r.length;++u){var s=r[u];i(s.width===a&&s.height===o,"inconsistent cube map face shape"),t.genMipmaps&&(i(!s.compressed,"can not generate mipmap for compressed textures"),i(1===s.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=s.images,l=0;l<16;++l){var h=c[l];if(h){var p=a>>l,d=o>>l;i(s.mipmask&1<<l,"missing mipmap data"),i(h.width===p&&h.height===d,"invalid shape for mip images"),i(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed||(h.data?i(h.data.byteLength===p*d*Math.max(J(h.type,f),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):h.element||h.copy)}}}}X[5120]=X[R]=1,X[q]=X[G]=X[$]=X[Q]=X[W]=X[V]=2,X[H]=X[N]=X[U]=X[Y]=4;var te=t(i,{optional:C,raise:a,commandRaise:E,command:T,parameter:f,commandParameter:j,constructor:p,type:s,commandType:D,isTypedArray:u,nni:c,oneOf:l,shaderError:M,linkError:A,callSite:y,saveCommandRef:_,saveDrawInfo:S,framebufferFormat:O,guessCommand:g,texture2D:K,textureCube:ee}),re=0,ne=0;function ae(e,t){this.id=re++,this.type=e,this.data=t}function ie(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function oe(e){if(0===e.length)return[];var t=e.charAt(0),r=e.charAt(e.length-1);if(e.length>1&&t===r&&('"'===t||"'"===t))return['"'+ie(e.substr(1,e.length-2))+'"'];var n=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(n)return oe(e.substr(0,n.index)).concat(oe(n[1])).concat(oe(e.substr(n.index+n[0].length)));var a=e.split(".");if(1===a.length)return['"'+ie(e)+'"'];for(var i=[],o=0;o<a.length;++o)i=i.concat(oe(a[o]));return i}function fe(e){return"["+oe(e).join("][")+"]"}function ue(e,t){return new ae(e,fe(t+""))}function se(e){return"function"==typeof e&&!e._reglType||e instanceof ae}function ce(e,t){return"function"==typeof e?new ae(ne,e):e}var le={DynamicVariable:ae,define:ue,isDynamic:se,unbox:ce,accessor:fe},he={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},pe="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function de(){var e={"":0},t=[""];return{id:function(r){var n=e[r];return n||(n=e[r]=t.length,t.push(r),n)},str:function(e){return t[e]}}}function me(e,r,n){var a=document.createElement("canvas");function i(){var r=window.innerWidth,i=window.innerHeight;if(e!==document.body){var o=e.getBoundingClientRect();r=o.right-o.left,i=o.bottom-o.top}a.width=n*r,a.height=n*i,t(a.style,{width:r+"px",height:i+"px"})}function o(){window.removeEventListener("resize",i),e.removeChild(a)}return t(a.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(a),e===document.body&&(a.style.position="absolute",t(e.style,{margin:0,padding:0})),window.addEventListener("resize",i,!1),i(),{canvas:a,onDestroy:o}}function be(e,t){function r(r){try{return e.getContext(r,t)}catch(e){return null}}return r("webgl")||r("experimental-webgl")||r("webgl-experimental")}function ve(e){return"string"==typeof e.nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect}function ge(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}function ye(e){return"string"==typeof e?e.split():(te(Array.isArray(e),"invalid extension array"),e)}function xe(e){return"string"==typeof e?(te("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function we(e){var t,r,n,a,i=e||{},o={},f=[],u=[],s="undefined"==typeof window?1:window.devicePixelRatio,c=!1,l=function(e){e&&te.raise(e)},h=function(){};if("string"==typeof i?(te("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),t=document.querySelector(i),te(t,"invalid query string for element")):"object"==typeof i?ve(i)?t=i:ge(i)?n=(a=i).canvas:(te.constructor(i),"gl"in i?a=i.gl:"canvas"in i?n=xe(i.canvas):"container"in i&&(r=xe(i.container)),"attributes"in i&&(o=i.attributes,te.type(o,"object","invalid context attributes")),"extensions"in i&&(f=ye(i.extensions)),"optionalExtensions"in i&&(u=ye(i.optionalExtensions)),"onDone"in i&&(te.type(i.onDone,"function","invalid or missing onDone callback"),l=i.onDone),"profile"in i&&(c=!!i.profile),"pixelRatio"in i&&(s=+i.pixelRatio,te(s>0,"invalid pixel ratio"))):te.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?n=t:r=t),!a){if(!n){te("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var p=me(r||document.body,l,s);if(!p)return null;n=p.canvas,h=p.onDestroy}a=be(n,o)}return a?{gl:a,canvas:n,container:r,extensions:f,optionalExtensions:u,pixelRatio:s,profile:c,onDone:l,onDestroy:h}:(h(),l("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ke(e,t){var r={};function n(t){te.type(t,"string","extension name must be string");var n,a=t.toLowerCase();try{n=r[a]=e.getExtension(a)}catch(e){}return!!n}for(var a=0;a<t.extensions.length;++a){var i=t.extensions[a];if(!n(i))return t.onDestroy(),t.onDone('"'+i+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(n),{extensions:r,restore:function(){Object.keys(r).forEach((function(e){if(!n(e))throw new Error("(regl): error restoring extension "+e)}))}}}function Me(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=t(n);return r}var Ae=5120,_e=5121,Se=5122,Ee=5123,Te=5124,je=5125,De=5126;function Ce(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function Oe(e){var t,r;return t=(e>65535)<<4,t|=r=((e>>>=t)>255)<<3,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1}function Pe(){var e=Me(8,(function(){return[]}));function t(t){var r=Ce(t),n=e[Oe(r)>>2];return n.length>0?n.pop():new ArrayBuffer(r)}function r(t){e[Oe(t.byteLength)>>2].push(t)}function n(e,r){var n=null;switch(e){case Ae:n=new Int8Array(t(r),0,r);break;case _e:n=new Uint8Array(t(r),0,r);break;case Se:n=new Int16Array(t(2*r),0,r);break;case Ee:n=new Uint16Array(t(2*r),0,r);break;case Te:n=new Int32Array(t(4*r),0,r);break;case je:n=new Uint32Array(t(4*r),0,r);break;case De:n=new Float32Array(t(4*r),0,r);break;default:return null}return n.length!==r?n.subarray(0,r):n}function a(e){r(e.buffer)}return{alloc:t,free:r,allocType:n,freeType:a}}var Fe=Pe();Fe.zero=Pe();var ze=3408,Be=3410,Le=3411,Ie=3412,Re=3413,qe=3414,Ge=3415,He=33901,Ne=33902,Ue=3379,We=3386,Ve=34921,Qe=36347,Ye=36348,$e=35661,Xe=35660,Je=34930,Ze=36349,Ke=34076,et=34024,tt=7936,rt=7937,nt=7938,at=35724,it=34047,ot=36063,ft=34852,ut=3553,st=34067,ct=34069,lt=33984,ht=6408,pt=5126,dt=5121,mt=36160,bt=36053,vt=36064,gt=16384,yt=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(it));var n=1,a=1;t.webgl_draw_buffers&&(n=e.getParameter(ft),a=e.getParameter(ot));var i=!!t.oes_texture_float;if(i){var o=e.createTexture();e.bindTexture(ut,o),e.texImage2D(ut,0,ht,1,1,0,ht,pt,null);var f=e.createFramebuffer();if(e.bindFramebuffer(mt,f),e.framebufferTexture2D(mt,vt,ut,o,0),e.bindTexture(ut,null),e.checkFramebufferStatus(mt)!==bt)i=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(gt);var u=Fe.allocType(pt,4);e.readPixels(0,0,1,1,ht,pt,u),e.getError()?i=!1:(e.deleteFramebuffer(f),e.deleteTexture(o),i=1===u[0]),Fe.freeType(u)}}var s=!0,c=e.createTexture(),l=Fe.allocType(dt,36);return e.activeTexture(lt),e.bindTexture(st,c),e.texImage2D(ct,0,ht,3,3,0,ht,dt,l),Fe.freeType(l),e.bindTexture(st,null),e.deleteTexture(c),s=!e.getError(),{colorBits:[e.getParameter(Be),e.getParameter(Le),e.getParameter(Ie),e.getParameter(Re)],depthBits:e.getParameter(qe),stencilBits:e.getParameter(Ge),subpixelBits:e.getParameter(ze),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:a,pointSizeDims:e.getParameter(He),lineWidthDims:e.getParameter(Ne),maxViewportDims:e.getParameter(We),maxCombinedTextureUnits:e.getParameter($e),maxCubeMapSize:e.getParameter(Ke),maxRenderbufferSize:e.getParameter(et),maxTextureUnits:e.getParameter(Je),maxTextureSize:e.getParameter(Ue),maxAttributes:e.getParameter(Ve),maxVertexUniforms:e.getParameter(Qe),maxVertexTextureUnits:e.getParameter(Xe),maxVaryingVectors:e.getParameter(Ye),maxFragmentUniforms:e.getParameter(Ze),glsl:e.getParameter(at),renderer:e.getParameter(rt),vendor:e.getParameter(tt),version:e.getParameter(nt),readFloat:i,npotTextureCube:s}};function xt(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var wt=function(e){return Object.keys(e).map((function(t){return e[t]}))},kt={shape:Tt,flatten:Et};function Mt(e,t,r){for(var n=0;n<t;++n)r[n]=e[n]}function At(e,t,r,n){for(var a=0,i=0;i<t;++i)for(var o=e[i],f=0;f<r;++f)n[a++]=o[f]}function _t(e,t,r,n,a,i){for(var o=i,f=0;f<t;++f)for(var u=e[f],s=0;s<r;++s)for(var c=u[s],l=0;l<n;++l)a[o++]=c[l]}function St(e,t,r,n,a){for(var i=1,o=r+1;o<t.length;++o)i*=t[o];var f=t[r];if(t.length-r==4){var u=t[r+1],s=t[r+2],c=t[r+3];for(o=0;o<f;++o)_t(e[o],u,s,c,n,a),a+=i}else for(o=0;o<f;++o)St(e[o],t,r+1,n,a),a+=i}function Et(e,t,r,n){var a=1;if(t.length)for(var i=0;i<t.length;++i)a*=t[i];else a=0;var o=n||Fe.allocType(r,a);switch(t.length){case 0:break;case 1:Mt(e,t[0],o);break;case 2:At(e,t[0],t[1],o);break;case 3:_t(e,t[0],t[1],t[2],o,0);break;default:St(e,t,0,o,0)}return o}function Tt(e){for(var t=[],r=e;r.length;r=r[0])t.push(r.length);return t}var jt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Dt={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Ct={dynamic:35048,stream:35040,static:35044},Ot=kt.flatten,Pt=kt.shape,Ft=35044,zt=35040,Bt=5121,Lt=5126,It=[];function Rt(e){return 0|jt[Object.prototype.toString.call(e)]}function qt(e,t){for(var r=0;r<t.length;++r)e[r]=t[r]}function Gt(e,t,r,n,a,i,o){for(var f=0,u=0;u<r;++u)for(var s=0;s<n;++s)e[f++]=t[a*u+i*s+o]}function Ht(t,r,n,a){var i=0,o={};function f(e){this.id=i++,this.buffer=t.createBuffer(),this.type=e,this.usage=Ft,this.byteLength=0,this.dimension=1,this.dtype=Bt,this.persistentData=null,n.profile&&(this.stats={size:0})}f.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},f.prototype.destroy=function(){p(this)};var u=[];function s(e,t){var r=u.pop();return r||(r=new f(e)),r.bind(),h(r,t,zt,0,1,!1),r}function c(e){u.push(e)}function l(e,r,n){e.byteLength=r.byteLength,t.bufferData(e.type,r,n)}function h(t,r,n,a,i,o){var f,u;if(t.usage=n,Array.isArray(r)){if(t.dtype=a||Lt,r.length>0)if(Array.isArray(r[0])){f=Pt(r);for(var s=1,c=1;c<f.length;++c)s*=f[c];t.dimension=s,l(t,u=Ot(r,f,t.dtype),n),o?t.persistentData=u:Fe.freeType(u)}else if("number"==typeof r[0]){t.dimension=i;var h=Fe.allocType(t.dtype,r.length);qt(h,r),l(t,h,n),o?t.persistentData=h:Fe.freeType(h)}else e(r[0])?(t.dimension=r[0].length,t.dtype=a||Rt(r[0])||Lt,l(t,u=Ot(r,[r.length,r[0].length],t.dtype),n),o?t.persistentData=u:Fe.freeType(u)):te.raise("invalid buffer data")}else if(e(r))t.dtype=a||Rt(r),t.dimension=i,l(t,r,n),o&&(t.persistentData=new Uint8Array(new Uint8Array(r.buffer)));else if(xt(r)){f=r.shape;var p=r.stride,d=r.offset,m=0,b=0,v=0,g=0;1===f.length?(m=f[0],b=1,v=p[0],g=0):2===f.length?(m=f[0],b=f[1],v=p[0],g=p[1]):te.raise("invalid shape"),t.dtype=a||Rt(r.data)||Lt,t.dimension=b;var y=Fe.allocType(t.dtype,m*b);Gt(y,r.data,m,b,v,g,d),l(t,y,n),o?t.persistentData=y:Fe.freeType(y)}else te.raise("invalid buffer data")}function p(e){r.bufferCount--;for(var n=0;n<a.state.length;++n){var i=a.state[n];i.buffer===e&&(t.disableVertexAttribArray(n),i.buffer=null)}var f=e.buffer;te(f,"buffer must not be deleted already"),t.deleteBuffer(f),e.buffer=null,delete o[e.id]}function d(a,i,u,s){r.bufferCount++;var c=new f(i);function l(r){var a=Ft,i=null,o=0,f=0,u=1;return Array.isArray(r)||e(r)||xt(r)?i=r:"number"==typeof r?o=0|r:r&&(te.type(r,"object","buffer arguments must be an object, a number or an array"),"data"in r&&(te(null===i||Array.isArray(i)||e(i)||xt(i),"invalid data for buffer"),i=r.data),"usage"in r&&(te.parameter(r.usage,Ct,"invalid buffer usage"),a=Ct[r.usage]),"type"in r&&(te.parameter(r.type,Dt,"invalid buffer type"),f=Dt[r.type]),"dimension"in r&&(te.type(r.dimension,"number","invalid dimension"),u=0|r.dimension),"length"in r&&(te.nni(o,"buffer length must be a nonnegative integer"),o=0|r.length)),c.bind(),i?h(c,i,a,f,u,s):(o&&t.bufferData(c.type,o,a),c.dtype=f||Bt,c.usage=a,c.dimension=u,c.byteLength=o),n.profile&&(c.stats.size=c.byteLength*It[c.dtype]),l}function d(e,r){te(r+e.byteLength<=c.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+r+" to a buffer of size "+c.byteLength),t.bufferSubData(c.type,r,e)}function m(t,r){var n,a=0|(r||0);if(c.bind(),e(t))d(t,a);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var i=Fe.allocType(c.dtype,t.length);qt(i,t),d(i,a),Fe.freeType(i)}else if(Array.isArray(t[0])||e(t[0])){n=Pt(t);var o=Ot(t,n,c.dtype);d(o,a),Fe.freeType(o)}else te.raise("invalid buffer data")}else if(xt(t)){n=t.shape;var f=t.stride,u=0,s=0,h=0,p=0;1===n.length?(u=n[0],s=1,h=f[0],p=0):2===n.length?(u=n[0],s=n[1],h=f[0],p=f[1]):te.raise("invalid shape");var m=Array.isArray(t.data)?c.dtype:Rt(t.data),b=Fe.allocType(m,u*s);Gt(b,t.data,u,s,h,p,t.offset),d(b,a),Fe.freeType(b)}else te.raise("invalid data for buffer subdata");return l}return o[c.id]=c,u||l(a),l._reglType="buffer",l._buffer=c,l.subdata=m,n.profile&&(l.stats=c.stats),l.destroy=function(){p(c)},l}function m(){wt(o).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))}return n.profile&&(r.getTotalBufferSize=function(){var e=0;return Object.keys(o).forEach((function(t){e+=o[t].stats.size})),e}),{create:d,createStream:s,destroyStream:c,clear:function(){wt(o).forEach(p),u.forEach(p)},getBuffer:function(e){return e&&e._buffer instanceof f?e._buffer:null},restore:m,_initBuffer:h}}It[5120]=1,It[5122]=2,It[5124]=4,It[5121]=1,It[5123]=2,It[5125]=4,It[5126]=4;var Nt={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Ut=0,Wt=1,Vt=4,Qt=5120,Yt=5121,$t=5122,Xt=5123,Jt=5124,Zt=5125,Kt=34963,er=35040,tr=35044;function rr(t,r,n,a){var i={},o=0,f={uint8:Yt,uint16:Xt};function u(e){this.id=o++,i[this.id]=this,this.buffer=e,this.primType=Vt,this.vertCount=0,this.type=0}r.oes_element_index_uint&&(f.uint32=Zt),u.prototype.bind=function(){this.buffer.bind()};var s=[];function c(e){var t=s.pop();return t||(t=new u(n.create(null,Kt,!0,!1)._buffer)),h(t,e,er,-1,-1,0,0),t}function l(e){s.push(e)}function h(a,i,o,f,u,s,c){if(a.buffer.bind(),i){var l=c;c||e(i)&&(!xt(i)||e(i.data))||(l=r.oes_element_index_uint?Zt:Xt),n._initBuffer(a.buffer,i,o,l,3)}else t.bufferData(Kt,s,o),a.buffer.dtype=h||Yt,a.buffer.usage=o,a.buffer.dimension=3,a.buffer.byteLength=s;var h=c;if(!c){switch(a.buffer.dtype){case Yt:case Qt:h=Yt;break;case Xt:case $t:h=Xt;break;case Zt:case Jt:h=Zt;break;default:te.raise("unsupported type for element array")}a.buffer.dtype=h}a.type=h,te(h!==Zt||!!r.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=a.buffer.byteLength,h===Xt?p>>=1:h===Zt&&(p>>=2)),a.vertCount=p;var d=f;if(f<0){d=Vt;var m=a.buffer.dimension;1===m&&(d=Ut),2===m&&(d=Wt),3===m&&(d=Vt)}a.primType=d}function p(e){a.elementsCount--,te(null!==e.buffer,"must not double destroy elements"),delete i[e.id],e.buffer.destroy(),e.buffer=null}function d(t,r){var i=n.create(null,Kt,!0),o=new u(i._buffer);function s(t){if(t)if("number"==typeof t)i(t),o.primType=Vt,o.vertCount=0|t,o.type=Yt;else{var r=null,n=tr,a=-1,u=-1,c=0,l=0;Array.isArray(t)||e(t)||xt(t)?r=t:(te.type(t,"object","invalid arguments for elements"),"data"in t&&(r=t.data,te(Array.isArray(r)||e(r)||xt(r),"invalid data for element buffer")),"usage"in t&&(te.parameter(t.usage,Ct,"invalid element buffer usage"),n=Ct[t.usage]),"primitive"in t&&(te.parameter(t.primitive,Nt,"invalid element buffer primitive"),a=Nt[t.primitive]),"count"in t&&(te("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(te.parameter(t.type,f,"invalid buffer type"),l=f[t.type]),"length"in t?c=0|t.length:(c=u,l===Xt||l===$t?c*=2:l!==Zt&&l!==Jt||(c*=4))),h(o,r,n,a,u,c,l)}else i(),o.primType=Vt,o.vertCount=0,o.type=Yt;return s}return a.elementsCount++,s(t),s._reglType="elements",s._elements=o,s.subdata=function(e,t){return i.subdata(e,t),s},s.destroy=function(){p(o)},s}return{create:d,createStream:c,destroyStream:l,getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){wt(i).forEach(p)}}}var nr=new Float32Array(1),ar=new Uint32Array(nr.buffer),ir=5123;function or(e){for(var t=Fe.allocType(ir,e.length),r=0;r<e.length;++r)if(isNaN(e[r]))t[r]=65535;else if(e[r]===1/0)t[r]=31744;else if(e[r]===-1/0)t[r]=64512;else{nr[0]=e[r];var n=ar[0],a=n>>>31<<15,i=(n<<1>>>24)-127,o=n>>13&1023;if(i<-24)t[r]=a;else if(i<-14){var f=-14-i;t[r]=a+(o+1024>>f)}else t[r]=i>15?a+31744:a+(i+15<<10)+o}return t}function fr(t){return Array.isArray(t)||e(t)}var ur=function(e){return!(e&e-1||!e)},sr=34467,cr=3553,lr=34067,hr=34069,pr=6408,dr=6406,mr=6407,br=6409,vr=6410,gr=32854,yr=32855,xr=36194,wr=32819,kr=32820,Mr=33635,Ar=34042,_r=6402,Sr=34041,Er=35904,Tr=35906,jr=36193,Dr=33776,Cr=33777,Or=33778,Pr=33779,Fr=35986,zr=35987,Br=34798,Lr=35840,Ir=35841,Rr=35842,qr=35843,Gr=36196,Hr=5121,Nr=5123,Ur=5125,Wr=5126,Vr=10242,Qr=10243,Yr=10497,$r=33071,Xr=33648,Jr=10240,Zr=10241,Kr=9728,en=9729,tn=9984,rn=9985,nn=9986,an=9987,on=33170,fn=4352,un=4353,sn=4354,cn=34046,ln=3317,hn=37440,pn=37441,dn=37443,mn=37444,bn=33984,vn=[tn,nn,rn,an],gn=[0,br,vr,mr,pr],yn={};function xn(e){return"[object "+e+"]"}yn[br]=yn[dr]=yn[_r]=1,yn[Sr]=yn[vr]=2,yn[mr]=yn[Er]=3,yn[pr]=yn[Tr]=4;var wn=xn("HTMLCanvasElement"),kn=xn("CanvasRenderingContext2D"),Mn=xn("ImageBitmap"),An=xn("HTMLImageElement"),_n=xn("HTMLVideoElement"),Sn=Object.keys(jt).concat([wn,kn,Mn,An,_n]),En=[];En[Hr]=1,En[Wr]=4,En[jr]=2,En[Nr]=2,En[Ur]=4;var Tn=[];function jn(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function Dn(e){return!!Array.isArray(e)&&!(0===e.length||!fr(e[0]))}function Cn(e){return Object.prototype.toString.call(e)}function On(e){return Cn(e)===wn}function Pn(e){return Cn(e)===kn}function Fn(e){return Cn(e)===Mn}function zn(e){return Cn(e)===An}function Bn(e){return Cn(e)===_n}function Ln(e){if(!e)return!1;var t=Cn(e);return Sn.indexOf(t)>=0||jn(e)||Dn(e)||xt(e)}function In(e){return 0|jt[Object.prototype.toString.call(e)]}function Rn(e,t){var r=t.length;switch(e.type){case Hr:case Nr:case Ur:case Wr:var n=Fe.allocType(e.type,r);n.set(t),e.data=n;break;case jr:e.data=or(t);break;default:te.raise("unsupported texture type, must specify a typed array")}}function qn(e,t){return Fe.allocType(e.type===jr?Wr:e.type,t)}function Gn(e,t){e.type===jr?(e.data=or(t),Fe.freeType(t)):e.data=t}function Hn(e,t,r,n,a,i){for(var o=e.width,f=e.height,u=e.channels,s=qn(e,o*f*u),c=0,l=0;l<f;++l)for(var h=0;h<o;++h)for(var p=0;p<u;++p)s[c++]=t[r*h+n*l+a*p+i];Gn(e,s)}function Nn(e,t,r,n,a,i){var o;if(o=void 0!==Tn[e]?Tn[e]:yn[e]*En[t],i&&(o*=6),a){for(var f=0,u=r;u>=1;)f+=o*u*u,u/=2;return f}return o*r*n}function Un(r,n,a,i,o,f,u){var s={"don't care":fn,"dont care":fn,nice:sn,fast:un},c={repeat:Yr,clamp:$r,mirror:Xr},l={nearest:Kr,linear:en},h=t({mipmap:an,"nearest mipmap nearest":tn,"linear mipmap nearest":rn,"nearest mipmap linear":nn,"linear mipmap linear":an},l),p={none:0,browser:mn},d={uint8:Hr,rgba4:wr,rgb565:Mr,"rgb5 a1":kr},m={alpha:dr,luminance:br,"luminance alpha":vr,rgb:mr,rgba:pr,rgba4:gr,"rgb5 a1":yr,rgb565:xr},b={};n.ext_srgb&&(m.srgb=Er,m.srgba=Tr),n.oes_texture_float&&(d.float32=d.float=Wr),n.oes_texture_half_float&&(d.float16=d["half float"]=jr),n.webgl_depth_texture&&(t(m,{depth:_r,"depth stencil":Sr}),t(d,{uint16:Nr,uint32:Ur,"depth stencil":Ar})),n.webgl_compressed_texture_s3tc&&t(b,{"rgb s3tc dxt1":Dr,"rgba s3tc dxt1":Cr,"rgba s3tc dxt3":Or,"rgba s3tc dxt5":Pr}),n.webgl_compressed_texture_atc&&t(b,{"rgb atc":Fr,"rgba atc explicit alpha":zr,"rgba atc interpolated alpha":Br}),n.webgl_compressed_texture_pvrtc&&t(b,{"rgb pvrtc 4bppv1":Lr,"rgb pvrtc 2bppv1":Ir,"rgba pvrtc 4bppv1":Rr,"rgba pvrtc 2bppv1":qr}),n.webgl_compressed_texture_etc1&&(b["rgb etc1"]=Gr);var v=Array.prototype.slice.call(r.getParameter(sr));Object.keys(b).forEach((function(e){var t=b[e];v.indexOf(t)>=0&&(m[e]=t)}));var g=Object.keys(m);a.textureFormats=g;var y=[];Object.keys(m).forEach((function(e){var t=m[e];y[t]=e}));var x=[];Object.keys(d).forEach((function(e){var t=d[e];x[t]=e}));var w=[];Object.keys(l).forEach((function(e){var t=l[e];w[t]=e}));var k=[];Object.keys(h).forEach((function(e){var t=h[e];k[t]=e}));var M=[];Object.keys(c).forEach((function(e){var t=c[e];M[t]=e}));var A=g.reduce((function(e,t){var r=m[t];return r===br||r===dr||r===br||r===vr||r===_r||r===Sr?e[r]=r:r===yr||t.indexOf("rgba")>=0?e[r]=pr:e[r]=mr,e}),{});function _(){this.internalformat=pr,this.format=pr,this.type=Hr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=mn,this.width=0,this.height=0,this.channels=0}function S(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function E(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(te.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(te.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(te.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(te.parameter(t.colorSpace,p,"invalid colorSpace"),e.colorSpace=p[t.colorSpace]),"type"in t){var r=t.type;te(n.oes_texture_float||!("float"===r||"float32"===r),"you must enable the OES_texture_float extension in order to use floating point textures."),te(n.oes_texture_half_float||!("half float"===r||"float16"===r),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),te(n.webgl_depth_texture||!("uint16"===r||"uint32"===r||"depth stencil"===r),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),te.parameter(r,d,"invalid texture type"),e.type=d[r]}var i=e.width,o=e.height,f=e.channels,u=!1;"shape"in t?(te(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),i=t.shape[0],o=t.shape[1],3===t.shape.length&&(f=t.shape[2],te(f>0&&f<=4,"invalid number of channels"),u=!0),te(i>=0&&i<=a.maxTextureSize,"invalid width"),te(o>=0&&o<=a.maxTextureSize,"invalid height")):("radius"in t&&(i=o=t.radius,te(i>=0&&i<=a.maxTextureSize,"invalid radius")),"width"in t&&(i=t.width,te(i>=0&&i<=a.maxTextureSize,"invalid width")),"height"in t&&(o=t.height,te(o>=0&&o<=a.maxTextureSize,"invalid height")),"channels"in t&&(f=t.channels,te(f>0&&f<=4,"invalid number of channels"),u=!0)),e.width=0|i,e.height=0|o,e.channels=0|f;var s=!1;if("format"in t){var c=t.format;te(n.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),te.parameter(c,m,"invalid texture format");var l=e.internalformat=m[c];e.format=A[l],c in d&&("type"in t||(e.type=d[c])),c in b&&(e.compressed=!0),s=!0}!u&&s?e.channels=yn[e.format]:u&&!s?e.channels!==gn[e.format]&&(e.format=e.internalformat=gn[e.channels]):s&&u&&te(e.channels===yn[e.format],"number of channels inconsistent with specified format")}}function T(e){r.pixelStorei(hn,e.flipY),r.pixelStorei(pn,e.premultiplyAlpha),r.pixelStorei(dn,e.colorSpace),r.pixelStorei(ln,e.unpackAlignment)}function j(){_.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function D(t,r){var n=null;if(Ln(r)?n=r:r&&(te.type(r,"object","invalid pixel data type"),E(t,r),"x"in r&&(t.xOffset=0|r.x),"y"in r&&(t.yOffset=0|r.y),Ln(r.data)&&(n=r.data)),te(!t.compressed||n instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),r.copy){te(!n,"can not specify copy and data field for the same texture");var i=o.viewportWidth,f=o.viewportHeight;t.width=t.width||i-t.xOffset,t.height=t.height||f-t.yOffset,t.needsCopy=!0,te(t.xOffset>=0&&t.xOffset<i&&t.yOffset>=0&&t.yOffset<f&&t.width>0&&t.width<=i&&t.height>0&&t.height<=f,"copy texture read out of bounds")}else if(n){if(e(n))t.channels=t.channels||4,t.data=n,"type"in r||t.type!==Hr||(t.type=In(n));else if(jn(n))t.channels=t.channels||4,Rn(t,n),t.alignment=1,t.needsFree=!0;else if(xt(n)){var u=n.data;Array.isArray(u)||t.type!==Hr||(t.type=In(u));var s,c,l,h,p,d,m=n.shape,b=n.stride;3===m.length?(l=m[2],d=b[2]):(te(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),l=1,d=1),s=m[0],c=m[1],h=b[0],p=b[1],t.alignment=1,t.width=s,t.height=c,t.channels=l,t.format=t.internalformat=gn[l],t.needsFree=!0,Hn(t,u,h,p,d,n.offset)}else if(On(n)||Pn(n))On(n)?t.element=n:t.element=n.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(Fn(n))t.element=n,t.width=n.width,t.height=n.height,t.channels=4;else if(zn(n))t.element=n,t.width=n.naturalWidth,t.height=n.naturalHeight,t.channels=4;else if(Bn(n))t.element=n,t.width=n.videoWidth,t.height=n.videoHeight,t.channels=4;else if(Dn(n)){var v=t.width||n[0].length,g=t.height||n.length,y=t.channels;y=fr(n[0][0])?y||n[0][0].length:y||1;for(var x=kt.shape(n),w=1,k=0;k<x.length;++k)w*=x[k];var M=qn(t,w);kt.flatten(n,x,"",M),Gn(t,M),t.alignment=1,t.width=v,t.height=g,t.channels=y,t.format=t.internalformat=gn[y],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===Wr?te(a.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===jr&&te(a.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function C(e,t,n){var a=e.element,o=e.data,f=e.internalformat,u=e.format,s=e.type,c=e.width,l=e.height,h=e.channels;if(T(e),a)r.texImage2D(t,n,u,u,s,a);else if(e.compressed)r.compressedTexImage2D(t,n,f,c,l,0,o);else if(e.needsCopy)i(),r.copyTexImage2D(t,n,u,e.xOffset,e.yOffset,c,l,0);else{var p=!o;p&&(o=Fe.zero.allocType(s,c*l*h)),r.texImage2D(t,n,u,c,l,0,u,s,o),p&&o&&Fe.zero.freeType(o)}}function O(e,t,n,a,o){var f=e.element,u=e.data,s=e.internalformat,c=e.format,l=e.type,h=e.width,p=e.height;T(e),f?r.texSubImage2D(t,o,n,a,c,l,f):e.compressed?r.compressedTexSubImage2D(t,o,n,a,s,h,p,u):e.needsCopy?(i(),r.copyTexSubImage2D(t,o,n,a,e.xOffset,e.yOffset,h,p)):r.texSubImage2D(t,o,n,a,h,p,c,l,u)}var P=[];function F(){return P.pop()||new j}function z(e){e.needsFree&&Fe.freeType(e.data),j.call(e),P.push(e)}function B(){_.call(this),this.genMipmaps=!1,this.mipmapHint=fn,this.mipmask=0,this.images=Array(16)}function L(e,t,r){var n=e.images[0]=F();e.mipmask=1,n.width=e.width=t,n.height=e.height=r,n.channels=e.channels=4}function I(e,t){var r=null;if(Ln(t))S(r=e.images[0]=F(),e),D(r,t),e.mipmask=1;else if(E(e,t),Array.isArray(t.mipmap))for(var n=t.mipmap,a=0;a<n.length;++a)S(r=e.images[a]=F(),e),r.width>>=a,r.height>>=a,D(r,n[a]),e.mipmask|=1<<a;else S(r=e.images[0]=F(),e),D(r,t),e.mipmask=1;S(e,e.images[0]),(e.compressed&&e.internalformat===Dr||e.internalformat===Cr||e.internalformat===Or||e.internalformat===Pr)&&te(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function R(e,t){for(var r=e.images,n=0;n<r.length;++n){if(!r[n])return;C(r[n],t,n)}}var q=[];function G(){var e=q.pop()||new B;_.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function H(e){for(var t=e.images,r=0;r<t.length;++r)t[r]&&z(t[r]),t[r]=null;q.push(e)}function N(){this.minFilter=Kr,this.magFilter=Kr,this.wrapS=$r,this.wrapT=$r,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=fn}function U(e,t){if("min"in t){var r=t.min;te.parameter(r,h),e.minFilter=h[r],vn.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var n=t.mag;te.parameter(n,l),e.magFilter=l[n]}var i=e.wrapS,o=e.wrapT;if("wrap"in t){var f=t.wrap;"string"==typeof f?(te.parameter(f,c),i=o=c[f]):Array.isArray(f)&&(te.parameter(f[0],c),te.parameter(f[1],c),i=c[f[0]],o=c[f[1]])}else{if("wrapS"in t){var u=t.wrapS;te.parameter(u,c),i=c[u]}if("wrapT"in t){var p=t.wrapT;te.parameter(p,c),o=c[p]}}if(e.wrapS=i,e.wrapT=o,"anisotropic"in t){var d=t.anisotropic;te("number"==typeof d&&d>=1&&d<=a.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var m=!1;switch(typeof t.mipmap){case"string":te.parameter(t.mipmap,s,"invalid mipmap hint"),e.mipmapHint=s[t.mipmap],e.genMipmaps=!0,m=!0;break;case"boolean":m=e.genMipmaps=t.mipmap;break;case"object":te(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,m=!0;break;default:te.raise("invalid mipmap type")}m&&!("min"in t)&&(e.minFilter=tn)}}function W(e,t){r.texParameteri(t,Zr,e.minFilter),r.texParameteri(t,Jr,e.magFilter),r.texParameteri(t,Vr,e.wrapS),r.texParameteri(t,Qr,e.wrapT),n.ext_texture_filter_anisotropic&&r.texParameteri(t,cn,e.anisotropic),e.genMipmaps&&(r.hint(on,e.mipmapHint),r.generateMipmap(t))}var V=0,Q={},Y=a.maxTextureUnits,$=Array(Y).map((function(){return null}));function X(e){_.call(this),this.mipmask=0,this.internalformat=pr,this.id=V++,this.refCount=1,this.target=e,this.texture=r.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new N,u.profile&&(this.stats={size:0})}function J(e){r.activeTexture(bn),r.bindTexture(e.target,e.texture)}function Z(){var e=$[0];e?r.bindTexture(e.target,e.texture):r.bindTexture(cr,null)}function K(e){var t=e.texture;te(t,"must not double destroy texture");var n=e.unit,a=e.target;n>=0&&(r.activeTexture(bn+n),r.bindTexture(a,null),$[n]=null),r.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete Q[e.id],f.textureCount--}function ee(e,t){var n=new X(cr);function i(e,t){var r=n.texInfo;N.call(r);var o=G();return"number"==typeof e?L(o,0|e,"number"==typeof t?0|t:0|e):e?(te.type(e,"object","invalid arguments to regl.texture"),U(r,e),I(o,e)):L(o,1,1),r.genMipmaps&&(o.mipmask=(o.width<<1)-1),n.mipmask=o.mipmask,S(n,o),te.texture2D(r,o,a),n.internalformat=o.internalformat,i.width=o.width,i.height=o.height,J(n),R(o,cr),W(r,cr),Z(),H(o),u.profile&&(n.stats.size=Nn(n.internalformat,n.type,o.width,o.height,r.genMipmaps,!1)),i.format=y[n.internalformat],i.type=x[n.type],i.mag=w[r.magFilter],i.min=k[r.minFilter],i.wrapS=M[r.wrapS],i.wrapT=M[r.wrapT],i}function o(e,t,r,a){te(!!e,"must specify image data");var o=0|t,f=0|r,u=0|a,s=F();return S(s,n),s.width=0,s.height=0,D(s,e),s.width=s.width||(n.width>>u)-o,s.height=s.height||(n.height>>u)-f,te(n.type===s.type&&n.format===s.format&&n.internalformat===s.internalformat,"incompatible format for texture.subimage"),te(o>=0&&f>=0&&o+s.width<=n.width&&f+s.height<=n.height,"texture.subimage write out of bounds"),te(n.mipmask&1<<u,"missing mipmap data"),te(s.data||s.element||s.needsCopy,"missing image data"),J(n),O(s,cr,o,f,u),Z(),z(s),i}function s(e,t){var a,o=0|e,f=0|t||o;if(o===n.width&&f===n.height)return i;i.width=n.width=o,i.height=n.height=f,J(n);for(var s=n.channels,c=n.type,l=0;n.mipmask>>l;++l){var h=o>>l,p=f>>l;if(!h||!p)break;a=Fe.zero.allocType(c,h*p*s),r.texImage2D(cr,l,n.format,h,p,0,n.format,n.type,a),a&&Fe.zero.freeType(a)}return Z(),u.profile&&(n.stats.size=Nn(n.internalformat,n.type,o,f,!1,!1)),i}return Q[n.id]=n,f.textureCount++,i(e,t),i.subimage=o,i.resize=s,i._reglType="texture2d",i._texture=n,u.profile&&(i.stats=n.stats),i.destroy=function(){n.decRef()},i}function re(e,t,n,i,o,s){var c=new X(lr);Q[c.id]=c,f.cubeCount++;var l=new Array(6);function h(e,t,r,n,i,o){var f,s=c.texInfo;for(N.call(s),f=0;f<6;++f)l[f]=G();if("number"!=typeof e&&e)if("object"==typeof e)if(t)I(l[0],e),I(l[1],t),I(l[2],r),I(l[3],n),I(l[4],i),I(l[5],o);else if(U(s,e),E(c,e),"faces"in e){var p=e.faces;for(te(Array.isArray(p)&&6===p.length,"cube faces must be a length 6 array"),f=0;f<6;++f)te("object"==typeof p[f]&&!!p[f],"invalid input for cube map face"),S(l[f],c),I(l[f],p[f])}else for(f=0;f<6;++f)I(l[f],e);else te.raise("invalid arguments to cube map");else{var d=0|e||1;for(f=0;f<6;++f)L(l[f],d,d)}for(S(c,l[0]),a.npotTextureCube||te(ur(c.width)&&ur(c.height),"your browser does not support non power or two texture dimensions"),s.genMipmaps?c.mipmask=(l[0].width<<1)-1:c.mipmask=l[0].mipmask,te.textureCube(c,s,l,a),c.internalformat=l[0].internalformat,h.width=l[0].width,h.height=l[0].height,J(c),f=0;f<6;++f)R(l[f],hr+f);for(W(s,lr),Z(),u.profile&&(c.stats.size=Nn(c.internalformat,c.type,h.width,h.height,s.genMipmaps,!0)),h.format=y[c.internalformat],h.type=x[c.type],h.mag=w[s.magFilter],h.min=k[s.minFilter],h.wrapS=M[s.wrapS],h.wrapT=M[s.wrapT],f=0;f<6;++f)H(l[f]);return h}function p(e,t,r,n,a){te(!!t,"must specify image data"),te("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var i=0|r,o=0|n,f=0|a,u=F();return S(u,c),u.width=0,u.height=0,D(u,t),u.width=u.width||(c.width>>f)-i,u.height=u.height||(c.height>>f)-o,te(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),te(i>=0&&o>=0&&i+u.width<=c.width&&o+u.height<=c.height,"texture.subimage write out of bounds"),te(c.mipmask&1<<f,"missing mipmap data"),te(u.data||u.element||u.needsCopy,"missing image data"),J(c),O(u,hr+e,i,o,f),Z(),z(u),h}function d(e){var t=0|e;if(t!==c.width){h.width=c.width=t,h.height=c.height=t,J(c);for(var n=0;n<6;++n)for(var a=0;c.mipmask>>a;++a)r.texImage2D(hr+n,a,c.format,t>>a,t>>a,0,c.format,c.type,null);return Z(),u.profile&&(c.stats.size=Nn(c.internalformat,c.type,h.width,h.height,!1,!0)),h}}return h(e,t,n,i,o,s),h.subimage=p,h.resize=d,h._reglType="textureCube",h._texture=c,u.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h}function ne(){for(var e=0;e<Y;++e)r.activeTexture(bn+e),r.bindTexture(cr,null),$[e]=null;wt(Q).forEach(K),f.cubeCount=0,f.textureCount=0}function ae(){wt(Q).forEach((function(e){e.texture=r.createTexture(),r.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===cr)r.texImage2D(cr,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var n=0;n<6;++n)r.texImage2D(hr+n,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);W(e.texInfo,e.target)}))}return t(X.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var n=0;n<Y;++n){var a=$[n];if(a){if(a.bindCount>0)continue;a.unit=-1}$[n]=e,t=n;break}t>=Y&&te.raise("insufficient number of texture units"),u.profile&&f.maxTextureUnits<t+1&&(f.maxTextureUnits=t+1),e.unit=t,r.activeTexture(bn+t),r.bindTexture(e.target,e.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&K(this)}}),u.profile&&(f.getTotalTextureSize=function(){var e=0;return Object.keys(Q).forEach((function(t){e+=Q[t].stats.size})),e}),{create2D:ee,createCube:re,clear:ne,getTexture:function(e){return null},restore:ae}}Tn[gr]=2,Tn[yr]=2,Tn[xr]=2,Tn[Sr]=4,Tn[Dr]=.5,Tn[Cr]=.5,Tn[Or]=1,Tn[Pr]=1,Tn[Fr]=.5,Tn[zr]=1,Tn[Br]=1,Tn[Lr]=.5,Tn[Ir]=.25,Tn[Rr]=.5,Tn[qr]=.25,Tn[Gr]=.5;var Wn=36161,Vn=32854,Qn=32855,Yn=36194,$n=33189,Xn=36168,Jn=34041,Zn=35907,Kn=34836,ea=34842,ta=34843,ra=[];function na(e,t,r){return ra[e]*t*r}ra[Vn]=2,ra[Qn]=2,ra[Yn]=2,ra[$n]=2,ra[Xn]=1,ra[Jn]=4,ra[Zn]=4,ra[Kn]=16,ra[ea]=8,ra[ta]=6;var aa=function(e,t,r,n,a){var i={rgba4:Vn,rgb565:Yn,"rgb5 a1":Qn,depth:$n,stencil:Xn,"depth stencil":Jn};t.ext_srgb&&(i.srgba=Zn),t.ext_color_buffer_half_float&&(i.rgba16f=ea,i.rgb16f=ta),t.webgl_color_buffer_float&&(i.rgba32f=Kn);var o=[];Object.keys(i).forEach((function(e){var t=i[e];o[t]=e}));var f=0,u={};function s(e){this.id=f++,this.refCount=1,this.renderbuffer=e,this.format=Vn,this.width=0,this.height=0,a.profile&&(this.stats={size:0})}function c(t){var r=t.renderbuffer;te(r,"must not double destroy renderbuffer"),e.bindRenderbuffer(Wn,null),e.deleteRenderbuffer(r),t.renderbuffer=null,t.refCount=0,delete u[t.id],n.renderbufferCount--}function l(t,f){var c=new s(e.createRenderbuffer());function l(t,n){var f=0,u=0,s=Vn;if("object"==typeof t&&t){var h=t;if("shape"in h){var p=h.shape;te(Array.isArray(p)&&p.length>=2,"invalid renderbuffer shape"),f=0|p[0],u=0|p[1]}else"radius"in h&&(f=u=0|h.radius),"width"in h&&(f=0|h.width),"height"in h&&(u=0|h.height);"format"in h&&(te.parameter(h.format,i,"invalid renderbuffer format"),s=i[h.format])}else"number"==typeof t?(f=0|t,u="number"==typeof n?0|n:f):t?te.raise("invalid arguments to renderbuffer constructor"):f=u=1;if(te(f>0&&u>0&&f<=r.maxRenderbufferSize&&u<=r.maxRenderbufferSize,"invalid renderbuffer size"),f!==c.width||u!==c.height||s!==c.format)return l.width=c.width=f,l.height=c.height=u,c.format=s,e.bindRenderbuffer(Wn,c.renderbuffer),e.renderbufferStorage(Wn,s,f,u),te(0===e.getError(),"invalid render buffer format"),a.profile&&(c.stats.size=na(c.format,c.width,c.height)),l.format=o[c.format],l}function h(t,n){var i=0|t,o=0|n||i;return i===c.width&&o===c.height||(te(i>0&&o>0&&i<=r.maxRenderbufferSize&&o<=r.maxRenderbufferSize,"invalid renderbuffer size"),l.width=c.width=i,l.height=c.height=o,e.bindRenderbuffer(Wn,c.renderbuffer),e.renderbufferStorage(Wn,c.format,i,o),te(0===e.getError(),"invalid render buffer format"),a.profile&&(c.stats.size=na(c.format,c.width,c.height))),l}return u[c.id]=c,n.renderbufferCount++,l(t,f),l.resize=h,l._reglType="renderbuffer",l._renderbuffer=c,a.profile&&(l.stats=c.stats),l.destroy=function(){c.decRef()},l}function h(){wt(u).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(Wn,t.renderbuffer),e.renderbufferStorage(Wn,t.format,t.width,t.height)})),e.bindRenderbuffer(Wn,null)}return s.prototype.decRef=function(){--this.refCount<=0&&c(this)},a.profile&&(n.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach((function(t){e+=u[t].stats.size})),e}),{create:l,clear:function(){wt(u).forEach(c)},restore:h}},ia=36160,oa=36161,fa=3553,ua=34069,sa=36064,ca=36096,la=36128,ha=33306,pa=36053,da=36054,ma=36055,ba=36057,va=36061,ga=36193,ya=5121,xa=5126,wa=6407,ka=6408,Ma=6402,Aa=[wa,ka],_a=[];_a[ka]=4,_a[wa]=3;var Sa=[];Sa[ya]=1,Sa[xa]=4,Sa[ga]=2;var Ea=33189,Ta=36168,ja=34041,Da=[32854,32855,36194,35907,34842,34843,34836],Ca={};function Oa(e,r,n,a,i,o){var f={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],s=["rgba4","rgb565","rgb5 a1"];r.ext_srgb&&s.push("srgba"),r.ext_color_buffer_half_float&&s.push("rgba16f","rgb16f"),r.webgl_color_buffer_float&&s.push("rgba32f");var c=["uint8"];function l(e,t,r){this.target=e,this.texture=t,this.renderbuffer=r;var n=0,a=0;t?(n=t.width,a=t.height):r&&(n=r.width,a=r.height),this.width=n,this.height=a}function h(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function p(e,t,r){if(e)if(e.texture){var n=e.texture._texture,a=Math.max(1,n.width),i=Math.max(1,n.height);te(a===t&&i===r,"inconsistent width/height for supplied texture"),n.refCount+=1}else{var o=e.renderbuffer._renderbuffer;te(o.width===t&&o.height===r,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function d(t,r){r&&(r.texture?e.framebufferTexture2D(ia,t,r.target,r.texture._texture.texture,0):e.framebufferRenderbuffer(ia,t,oa,r.renderbuffer._renderbuffer.renderbuffer))}function m(e){var t=fa,r=null,n=null,a=e;"object"==typeof e&&(a=e.data,"target"in e&&(t=0|e.target)),te.type(a,"function","invalid attachment data");var i=a._reglType;return"texture2d"===i?(r=a,te(t===fa)):"textureCube"===i?(r=a,te(t>=ua&&t<ua+6,"invalid cube map target")):"renderbuffer"===i?(n=a,t=oa):te.raise("invalid regl object for attachment"),new l(t,r,n)}function b(e,t,r,n,o){if(r){var f=a.create2D({width:e,height:t,format:n,type:o});return f._texture.refCount=0,new l(fa,f,null)}var u=i.create({width:e,height:t,format:n});return u._renderbuffer.refCount=0,new l(oa,null,u)}function v(e){return e&&(e.texture||e.renderbuffer)}function g(e,t,r){e&&(e.texture?e.texture.resize(t,r):e.renderbuffer&&e.renderbuffer.resize(t,r))}r.oes_texture_half_float&&c.push("half float","float16"),r.oes_texture_float&&c.push("float","float32");var y=0,x={};function w(){this.id=y++,x[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function k(e){e.colorAttachments.forEach(h),h(e.depthAttachment),h(e.stencilAttachment),h(e.depthStencilAttachment)}function M(t){var r=t.framebuffer;te(r,"must not double destroy framebuffer"),e.deleteFramebuffer(r),t.framebuffer=null,o.framebufferCount--,delete x[t.id]}function A(t){var r;e.bindFramebuffer(ia,t.framebuffer);var a=t.colorAttachments;for(r=0;r<a.length;++r)d(sa+r,a[r]);for(r=a.length;r<n.maxColorAttachments;++r)e.framebufferTexture2D(ia,sa+r,fa,null,0);e.framebufferTexture2D(ia,ha,fa,null,0),e.framebufferTexture2D(ia,ca,fa,null,0),e.framebufferTexture2D(ia,la,fa,null,0),d(ca,t.depthAttachment),d(la,t.stencilAttachment),d(ha,t.depthStencilAttachment);var i=e.checkFramebufferStatus(ia);i!==pa&&te.raise("framebuffer configuration not supported, status = "+Ca[i]),e.bindFramebuffer(ia,f.next?f.next.framebuffer:null),f.cur=f.next,e.getError()}function _(e,a){var i=new w;function l(e,t){var a;te(f.next!==i,"can not update framebuffer which is currently in use");var o=r.webgl_draw_buffers,h=0,d=0,g=!0,y=!0,x=null,w=!0,M="rgba",_="uint8",S=1,E=null,T=null,j=null,D=!1;if("number"==typeof e)h=0|e,d=0|t||h;else if(e){te.type(e,"object","invalid arguments for framebuffer");var C=e;if("shape"in C){var O=C.shape;te(Array.isArray(O)&&O.length>=2,"invalid shape for framebuffer"),h=O[0],d=O[1]}else"radius"in C&&(h=d=C.radius),"width"in C&&(h=C.width),"height"in C&&(d=C.height);("color"in C||"colors"in C)&&(x=C.color||C.colors,Array.isArray(x)&&te(1===x.length||o,"multiple render targets not supported")),x||("colorCount"in C&&(S=0|C.colorCount,te(S>0,"invalid color buffer count")),"colorTexture"in C&&(w=!!C.colorTexture,M="rgba4"),"colorType"in C&&(_=C.colorType,w?(te(r.oes_texture_float||!("float"===_||"float32"===_),"you must enable OES_texture_float in order to use floating point framebuffer objects"),te(r.oes_texture_half_float||!("half float"===_||"float16"===_),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===_||"float16"===_?(te(r.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),M="rgba16f"):"float"!==_&&"float32"!==_||(te(r.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),M="rgba32f"),te.oneOf(_,c,"invalid color type")),"colorFormat"in C&&(M=C.colorFormat,u.indexOf(M)>=0?w=!0:s.indexOf(M)>=0?w=!1:w?te.oneOf(C.colorFormat,u,"invalid color format for texture"):te.oneOf(C.colorFormat,s,"invalid color format for renderbuffer"))),("depthTexture"in C||"depthStencilTexture"in C)&&(D=!(!C.depthTexture&&!C.depthStencilTexture),te(!D||r.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in C&&("boolean"==typeof C.depth?g=C.depth:(E=C.depth,y=!1)),"stencil"in C&&("boolean"==typeof C.stencil?y=C.stencil:(T=C.stencil,g=!1)),"depthStencil"in C&&("boolean"==typeof C.depthStencil?g=y=C.depthStencil:(j=C.depthStencil,g=!1,y=!1))}else h=d=1;var P=null,F=null,z=null,B=null;if(Array.isArray(x))P=x.map(m);else if(x)P=[m(x)];else for(P=new Array(S),a=0;a<S;++a)P[a]=b(h,d,w,M,_);te(r.webgl_draw_buffers||P.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),te(P.length<=n.maxColorAttachments,"too many color attachments, not supported"),h=h||P[0].width,d=d||P[0].height,E?F=m(E):g&&!y&&(F=b(h,d,D,"depth","uint32")),T?z=m(T):y&&!g&&(z=b(h,d,!1,"stencil","uint8")),j?B=m(j):!E&&!T&&y&&g&&(B=b(h,d,D,"depth stencil","depth stencil")),te(!!E+!!T+!!j<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var L=null;for(a=0;a<P.length;++a)if(p(P[a],h,d),te(!P[a]||P[a].texture&&Aa.indexOf(P[a].texture._texture.format)>=0||P[a].renderbuffer&&Da.indexOf(P[a].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+a+" is invalid"),P[a]&&P[a].texture){var I=_a[P[a].texture._texture.format]*Sa[P[a].texture._texture.type];null===L?L=I:te(L===I,"all color attachments much have the same number of bits per pixel.")}return p(F,h,d),te(!F||F.texture&&F.texture._texture.format===Ma||F.renderbuffer&&F.renderbuffer._renderbuffer.format===Ea,"invalid depth attachment for framebuffer object"),p(z,h,d),te(!z||z.renderbuffer&&z.renderbuffer._renderbuffer.format===Ta,"invalid stencil attachment for framebuffer object"),p(B,h,d),te(!B||B.texture&&B.texture._texture.format===ja||B.renderbuffer&&B.renderbuffer._renderbuffer.format===ja,"invalid depth-stencil attachment for framebuffer object"),k(i),i.width=h,i.height=d,i.colorAttachments=P,i.depthAttachment=F,i.stencilAttachment=z,i.depthStencilAttachment=B,l.color=P.map(v),l.depth=v(F),l.stencil=v(z),l.depthStencil=v(B),l.width=i.width,l.height=i.height,A(i),l}function h(e,t){te(f.next!==i,"can not resize a framebuffer which is currently in use");var r=0|e,n=0|t||r;if(r===i.width&&n===i.height)return l;for(var a=i.colorAttachments,o=0;o<a.length;++o)g(a[o],r,n);return g(i.depthAttachment,r,n),g(i.stencilAttachment,r,n),g(i.depthStencilAttachment,r,n),i.width=l.width=r,i.height=l.height=n,A(i),l}return o.framebufferCount++,l(e,a),t(l,{resize:h,_reglType:"framebuffer",_framebuffer:i,destroy:function(){M(i),k(i)},use:function(e){f.setFBO({framebuffer:l},e)}})}function S(e){var i=Array(6);function o(e){var n;te(i.indexOf(f.next)<0,"can not update framebuffer which is currently in use");var s,l=r.webgl_draw_buffers,h={color:null},p=0,d=null,m="rgba",b="uint8",v=1;if("number"==typeof e)p=0|e;else if(e){te.type(e,"object","invalid arguments for framebuffer");var g=e;if("shape"in g){var y=g.shape;te(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),te(y[0]===y[1],"cube framebuffer must be square"),p=y[0]}else"radius"in g&&(p=0|g.radius),"width"in g?(p=0|g.width,"height"in g&&te(g.height===p,"must be square")):"height"in g&&(p=0|g.height);("color"in g||"colors"in g)&&(d=g.color||g.colors,Array.isArray(d)&&te(1===d.length||l,"multiple render targets not supported")),d||("colorCount"in g&&(v=0|g.colorCount,te(v>0,"invalid color buffer count")),"colorType"in g&&(te.oneOf(g.colorType,c,"invalid color type"),b=g.colorType),"colorFormat"in g&&(m=g.colorFormat,te.oneOf(g.colorFormat,u,"invalid color format for texture"))),"depth"in g&&(h.depth=g.depth),"stencil"in g&&(h.stencil=g.stencil),"depthStencil"in g&&(h.depthStencil=g.depthStencil)}else p=1;if(d)if(Array.isArray(d))for(s=[],n=0;n<d.length;++n)s[n]=d[n];else s=[d];else{s=Array(v);var x={radius:p,format:m,type:b};for(n=0;n<v;++n)s[n]=a.createCube(x)}for(h.color=Array(s.length),n=0;n<s.length;++n){var w=s[n];te("function"==typeof w&&"textureCube"===w._reglType,"invalid cube map"),p=p||w.width,te(w.width===p&&w.height===p,"invalid cube map shape"),h.color[n]={target:ua,data:s[n]}}for(n=0;n<6;++n){for(var k=0;k<s.length;++k)h.color[k].target=ua+n;n>0&&(h.depth=i[0].depth,h.stencil=i[0].stencil,h.depthStencil=i[0].depthStencil),i[n]?i[n](h):i[n]=_(h)}return t(o,{width:p,height:p,color:s})}function s(e){var t,r=0|e;if(te(r>0&&r<=n.maxCubeMapSize,"invalid radius for cube fbo"),r===o.width)return o;var a=o.color;for(t=0;t<a.length;++t)a[t].resize(r);for(t=0;t<6;++t)i[t].resize(r);return o.width=o.height=r,o}return o(e),t(o,{faces:i,resize:s,_reglType:"framebufferCube",destroy:function(){i.forEach((function(e){e.destroy()}))}})}function E(){wt(x).forEach((function(t){t.framebuffer=e.createFramebuffer(),A(t)}))}return t(f,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof w)return t}return null},create:_,createCube:S,clear:function(){wt(x).forEach(M)},restore:E})}Ca[pa]="complete",Ca[da]="incomplete attachment",Ca[ba]="incomplete dimensions",Ca[ma]="incomplete, missing attachment",Ca[va]="unsupported";var Pa=5126;function Fa(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Pa,this.offset=0,this.stride=0,this.divisor=0}function za(e,t,r,n){for(var a=r.maxAttributes,i=new Array(a),o=0;o<a;++o)i[o]=new Fa;return{Record:Fa,scope:{},state:i}}var Ba=35632,La=35633,Ia=35718,Ra=35721;function qa(e,t,r,n){var a={},i={};function o(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function f(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id)return void(e[r].location=t.location);e.push(t)}function u(r,n,o){var f=r===Ba?a:i,u=f[n];if(!u){var s=t.str(n);u=e.createShader(r),e.shaderSource(u,s),e.compileShader(u),te.shaderError(e,u,s,r,o),f[n]=u}return u}var s={},c=[],l=0;function h(e,t){this.id=l++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],n.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(r,a){var i,s,c=u(Ba,r.fragId),l=u(La,r.vertId),h=r.program=e.createProgram();e.attachShader(h,c),e.attachShader(h,l),e.linkProgram(h),te.linkError(e,h,t.str(r.fragId),t.str(r.vertId),a);var p=e.getProgramParameter(h,Ia);n.profile&&(r.stats.uniformsCount=p);var d=r.uniforms;for(i=0;i<p;++i)if(s=e.getActiveUniform(h,i))if(s.size>1)for(var m=0;m<s.size;++m){var b=s.name.replace("[0]","["+m+"]");f(d,new o(b,t.id(b),e.getUniformLocation(h,b),s))}else f(d,new o(s.name,t.id(s.name),e.getUniformLocation(h,s.name),s));var v=e.getProgramParameter(h,Ra);n.profile&&(r.stats.attributesCount=v);var g=r.attributes;for(i=0;i<v;++i)(s=e.getActiveAttrib(h,i))&&f(g,new o(s.name,t.id(s.name),e.getAttribLocation(h,s.name),s))}function d(){a={},i={};for(var e=0;e<c.length;++e)p(c[e])}return n.profile&&(r.getMaxUniformsCount=function(){var e=0;return c.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},r.getMaxAttributesCount=function(){var e=0;return c.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);wt(a).forEach(t),a={},wt(i).forEach(t),i={},c.forEach((function(t){e.deleteProgram(t.program)})),c.length=0,s={},r.shaderCount=0},program:function(e,t,n){te.command(e>=0,"missing vertex shader",n),te.command(t>=0,"missing fragment shader",n);var a=s[t];a||(a=s[t]={});var i=a[e];return i||(i=new h(t,e),r.shaderCount++,p(i,n),a[e]=i,c.push(i)),i},restore:d,shader:u,frag:-1,vert:-1}}var Ga=6408,Ha=5121,Na=3333,Ua=5126;function Wa(t,r,n,a,i,o,f){function u(u){var s;null===r.next?(te(i.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),s=Ha):(te(null!==r.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),s=r.next.colorAttachments[0].texture._texture.type,o.oes_texture_float?(te(s===Ha||s===Ua,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),s===Ua&&te(f.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):te(s===Ha,"Reading from a framebuffer is only allowed for the type 'uint8'"));var c=0,l=0,h=a.framebufferWidth,p=a.framebufferHeight,d=null;e(u)?d=u:u&&(te.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,l=0|u.y,te(c>=0&&c<a.framebufferWidth,"invalid x offset for regl.read"),te(l>=0&&l<a.framebufferHeight,"invalid y offset for regl.read"),h=0|(u.width||a.framebufferWidth-c),p=0|(u.height||a.framebufferHeight-l),d=u.data||null),d&&(s===Ha?te(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):s===Ua&&te(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),te(h>0&&h+c<=a.framebufferWidth,"invalid width for read pixels"),te(p>0&&p+l<=a.framebufferHeight,"invalid height for read pixels"),n();var m=h*p*4;return d||(s===Ha?d=new Uint8Array(m):s===Ua&&(d=d||new Float32Array(m))),te.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),te(d.byteLength>=m,"data buffer for regl.read() too small"),t.pixelStorei(Na,4),t.readPixels(c,l,h,p,Ga,s,d),d}function s(e){var t;return r.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}function c(e){return e&&"framebuffer"in e?s(e):u(e)}return c}function Va(e){return Array.prototype.slice.call(e)}function Qa(e){return Va(e).join("")}function Ya(){var e=0,r=[],n=[];function a(t){for(var a=0;a<n.length;++a)if(n[a]===t)return r[a];var i="g"+e++;return r.push(i),n.push(t),i}function i(){var r=[];function n(){r.push.apply(r,Va(arguments))}var a=[];function i(){var t="v"+e++;return a.push(t),arguments.length>0&&(r.push(t,"="),r.push.apply(r,Va(arguments)),r.push(";")),t}return t(n,{def:i,toString:function(){return Qa([a.length>0?"var "+a+";":"",Qa(r)])}})}function o(){var e=i(),r=i(),n=e.toString,a=r.toString;function o(t,n){r(t,n,"=",e.def(t,n),";")}return t((function(){e.apply(e,Va(arguments))}),{def:e.def,entry:e,exit:r,save:o,set:function(t,r,n){o(t,r),e(t,r,"=",n,";")},toString:function(){return n()+a()}})}function f(){var e=Qa(arguments),r=o(),n=o(),a=r.toString,i=n.toString;return t(r,{then:function(){return r.apply(r,Va(arguments)),this},else:function(){return n.apply(n,Va(arguments)),this},toString:function(){var t=i();return t&&(t="else{"+t+"}"),Qa(["if(",e,"){",a(),"}",t])}})}var u=i(),s={};function c(e,r){var n=[];function a(){var e="a"+n.length;return n.push(e),e}r=r||0;for(var i=0;i<r;++i)a();var f=o(),u=f.toString;return s[e]=t(f,{arg:a,toString:function(){return Qa(["function(",n.join(),"){",u(),"}"])}})}function l(){var e=['"use strict";',u,"return {"];Object.keys(s).forEach((function(t){e.push('"',t,'":',s[t].toString(),",")})),e.push("}");var t=Qa(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,r.concat(t)).apply(null,n)}return{global:u,link:a,block:i,proc:c,scope:o,cond:f,compile:l}}var $a="xyzw".split(""),Xa=5121,Ja=1,Za=2,Ka=0,ei=1,ti=2,ri=3,ni=4,ai="dither",ii="blend.enable",oi="blend.color",fi="blend.equation",ui="blend.func",si="depth.enable",ci="depth.func",li="depth.range",hi="depth.mask",pi="colorMask",di="cull.enable",mi="cull.face",bi="frontFace",vi="lineWidth",gi="polygonOffset.enable",yi="polygonOffset.offset",xi="sample.alpha",wi="sample.enable",ki="sample.coverage",Mi="stencil.enable",Ai="stencil.mask",_i="stencil.func",Si="stencil.opFront",Ei="stencil.opBack",Ti="scissor.enable",ji="scissor.box",Di="viewport",Ci="profile",Oi="framebuffer",Pi="vert",Fi="frag",zi="elements",Bi="primitive",Li="count",Ii="offset",Ri="instances",qi="Width",Gi="Height",Hi=Oi+qi,Ni=Oi+Gi,Ui=Di+qi,Wi=Di+Gi,Vi="drawingBuffer",Qi=Vi+qi,Yi=Vi+Gi,$i=[ui,fi,_i,Si,Ei,ki,Di,ji,yi],Xi=34962,Ji=34963,Zi=3553,Ki=34067,eo=2884,to=3042,ro=3024,no=2960,ao=2929,io=3089,oo=32823,fo=32926,uo=32928,so=5126,co=35664,lo=35665,ho=35666,po=5124,mo=35667,bo=35668,vo=35669,go=35670,yo=35671,xo=35672,wo=35673,ko=35674,Mo=35675,Ao=35676,_o=35678,So=35680,Eo=4,To=1028,jo=1029,Do=2304,Co=2305,Oo=32775,Po=32776,Fo=519,zo=7680,Bo=0,Lo=1,Io=32774,Ro=513,qo=36160,Go=36064,Ho={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},No=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Uo={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Wo={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Vo={frag:35632,vert:35633},Qo={cw:Do,ccw:Co};function Yo(t){return Array.isArray(t)||e(t)||xt(t)}function $o(e){return e.sort((function(e,t){return e===Di?-1:t===Di?1:e<t?-1:1}))}function Xo(e,t,r,n){this.thisDep=e,this.contextDep=t,this.propDep=r,this.append=n}function Jo(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function Zo(e){return new Xo(!1,!1,!1,e)}function Ko(e,t){var r=e.type;if(r===Ka){var n=e.data.length;return new Xo(!0,n>=1,n>=2,t)}if(r===ni){var a=e.data;return new Xo(a.thisDep,a.contextDep,a.propDep,t)}return new Xo(r===ri,r===ti,r===ei,t)}var ef=new Xo(!1,!1,!1,(function(){}));function tf(e,t,r,n,a,i,o,f,u,s,c,l,h,p,d){var m=s.Record,b={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(b.min=Oo,b.max=Po);var v=r.angle_instanced_arrays,g=r.webgl_draw_buffers,y={dirty:!0,profile:d.profile},x={},w=[],k={},M={};function A(e){return e.replace(".","_")}function _(e,t,r){var n=A(e);w.push(e),x[n]=y[n]=!!r,k[n]=t}function S(e,t,r){var n=A(e);w.push(e),Array.isArray(r)?(y[n]=r.slice(),x[n]=r.slice()):y[n]=x[n]=r,M[n]=t}_(ai,ro),_(ii,to),S(oi,"blendColor",[0,0,0,0]),S(fi,"blendEquationSeparate",[Io,Io]),S(ui,"blendFuncSeparate",[Lo,Bo,Lo,Bo]),_(si,ao,!0),S(ci,"depthFunc",Ro),S(li,"depthRange",[0,1]),S(hi,"depthMask",!0),S(pi,pi,[!0,!0,!0,!0]),_(di,eo),S(mi,"cullFace",jo),S(bi,bi,Co),S(vi,vi,1),_(gi,oo),S(yi,"polygonOffset",[0,0]),_(xi,fo),_(wi,uo),S(ki,"sampleCoverage",[1,!1]),_(Mi,no),S(Ai,"stencilMask",-1),S(_i,"stencilFunc",[Fo,0,-1]),S(Si,"stencilOpSeparate",[To,zo,zo,zo]),S(Ei,"stencilOpSeparate",[jo,zo,zo,zo]),_(Ti,io),S(ji,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),S(Di,Di,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var E={gl:e,context:h,strings:t,next:x,current:y,draw:l,elements:i,buffer:a,shader:c,attributes:s.state,uniforms:u,framebuffer:f,extensions:r,timer:p,isBufferArgs:Yo},T={primTypes:Nt,compareFuncs:Uo,blendFuncs:Ho,blendEquations:b,stencilOps:Wo,glTypes:Dt,orientationType:Qo};te.optional((function(){E.isArrayLike=fr})),g&&(T.backBuffer=[jo],T.drawBuffer=Me(n.maxDrawbuffers,(function(e){return 0===e?[0]:Me(e,(function(e){return Go+e}))})));var j=0;function D(){var e=Ya(),r=e.link,n=e.global;e.id=j++,e.batchId="0";var a=r(E),i=e.shared={props:"a0"};Object.keys(E).forEach((function(e){i[e]=n.def(a,".",e)})),te.optional((function(){e.CHECK=r(te),e.commandStr=te.guessCommand(),e.command=r(e.commandStr),e.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},T.invalidBlendCombinations=No}));var o=e.next={},f=e.current={};Object.keys(M).forEach((function(e){Array.isArray(y[e])&&(o[e]=n.def(i.next,".",e),f[e]=n.def(i.current,".",e))}));var u=e.constants={};Object.keys(T).forEach((function(e){u[e]=n.def(JSON.stringify(T[e]))})),e.invoke=function(t,n){switch(n.type){case Ka:var a=["this",i.context,i.props,e.batchId];return t.def(r(n.data),".call(",a.slice(0,Math.max(n.data.length+1,4)),")");case ei:return t.def(i.props,n.data);case ti:return t.def(i.context,n.data);case ri:return t.def("this",n.data);case ni:return n.data.append(e,t),n.data.ref}},e.attribCache={};var c={};return e.scopeAttrib=function(e){var n=t.id(e);if(n in c)return c[n];var a=s.scope[n];return a||(a=s.scope[n]=new m),c[n]=r(a)},e}function C(e){var t,r=e.static,n=e.dynamic;if(Ci in r){var a=!!r[Ci];(t=Zo((function(e,t){return a}))).enable=a}else if(Ci in n){var i=n[Ci];t=Ko(i,(function(e,t){return e.invoke(t,i)}))}return t}function O(e,t){var r=e.static,n=e.dynamic;if(Oi in r){var a=r[Oi];return a?(a=f.getFramebuffer(a),te.command(a,"invalid framebuffer object"),Zo((function(e,t){var r=e.link(a),n=e.shared;t.set(n.framebuffer,".next",r);var i=n.context;return t.set(i,"."+Hi,r+".width"),t.set(i,"."+Ni,r+".height"),r}))):Zo((function(e,t){var r=e.shared;t.set(r.framebuffer,".next","null");var n=r.context;return t.set(n,"."+Hi,n+"."+Qi),t.set(n,"."+Ni,n+"."+Yi),"null"}))}if(Oi in n){var i=n[Oi];return Ko(i,(function(e,t){var r=e.invoke(t,i),n=e.shared,a=n.framebuffer,o=t.def(a,".getFramebuffer(",r,")");te.optional((function(){e.assert(t,"!"+r+"||"+o,"invalid framebuffer object")})),t.set(a,".next",o);var f=n.context;return t.set(f,"."+Hi,o+"?"+o+".width:"+f+"."+Qi),t.set(f,"."+Ni,o+"?"+o+".height:"+f+"."+Yi),o}))}return null}function P(e,t,r){var n=e.static,a=e.dynamic;function i(e){if(e in n){var i=n[e];te.commandType(i,"object","invalid "+e,r.commandStr);var o,f,u=!0,s=0|i.x,c=0|i.y;return"width"in i?(o=0|i.width,te.command(o>=0,"invalid "+e,r.commandStr)):u=!1,"height"in i?(f=0|i.height,te.command(f>=0,"invalid "+e,r.commandStr)):u=!1,new Xo(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var r=e.shared.context,n=o;"width"in i||(n=t.def(r,".",Hi,"-",s));var a=f;return"height"in i||(a=t.def(r,".",Ni,"-",c)),[s,c,n,a]}))}if(e in a){var l=a[e],h=Ko(l,(function(t,r){var n=t.invoke(r,l);te.optional((function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)}));var a=t.shared.context,i=r.def(n,".x|0"),o=r.def(n,".y|0"),f=r.def('"width" in ',n,"?",n,".width|0:","(",a,".",Hi,"-",i,")"),u=r.def('"height" in ',n,"?",n,".height|0:","(",a,".",Ni,"-",o,")");return te.optional((function(){t.assert(r,f+">=0&&"+u+">=0","invalid "+e)})),[i,o,f,u]}));return t&&(h.thisDep=h.thisDep||t.thisDep,h.contextDep=h.contextDep||t.contextDep,h.propDep=h.propDep||t.propDep),h}return t?new Xo(t.thisDep,t.contextDep,t.propDep,(function(e,t){var r=e.shared.context;return[0,0,t.def(r,".",Hi),t.def(r,".",Ni)]})):null}var o=i(Di);if(o){var f=o;o=new Xo(o.thisDep,o.contextDep,o.propDep,(function(e,t){var r=f.append(e,t),n=e.shared.context;return t.set(n,"."+Ui,r[2]),t.set(n,"."+Wi,r[3]),r}))}return{viewport:o,scissor_box:i(ji)}}function F(e){var r=e.static,n=e.dynamic;function a(e){if(e in r){var a=t.id(r[e]);te.optional((function(){c.shader(Vo[e],a,te.guessCommand())}));var i=Zo((function(){return a}));return i.id=a,i}if(e in n){var o=n[e];return Ko(o,(function(t,r){var n=t.invoke(r,o),a=r.def(t.shared.strings,".id(",n,")");return te.optional((function(){r(t.shared.shader,".shader(",Vo[e],",",a,",",t.command,");")})),a}))}return null}var i,o=a(Fi),f=a(Pi),u=null;return Jo(o)&&Jo(f)?(u=c.program(f.id,o.id),i=Zo((function(e,t){return e.link(u)}))):i=new Xo(o&&o.thisDep||f&&f.thisDep,o&&o.contextDep||f&&f.contextDep,o&&o.propDep||f&&f.propDep,(function(e,t){var r,n=e.shared.shader;r=o?o.append(e,t):t.def(n,".",Fi);var a=n+".program("+(f?f.append(e,t):t.def(n,".",Pi))+","+r;return te.optional((function(){a+=","+e.command})),t.def(a+")")})),{frag:o,vert:f,progVar:i,program:u}}function z(e,t){var r=e.static,n=e.dynamic;function a(){if(zi in r){var e=r[zi];Yo(e)?e=i.getElements(i.create(e,!0)):e&&(e=i.getElements(e),te.command(e,"invalid elements",t.commandStr));var a=Zo((function(t,r){if(e){var n=t.link(e);return t.ELEMENTS=n,n}return t.ELEMENTS=null,null}));return a.value=e,a}if(zi in n){var o=n[zi];return Ko(o,(function(e,t){var r=e.shared,n=r.isBufferArgs,a=r.elements,i=e.invoke(t,o),f=t.def("null"),u=t.def(n,"(",i,")"),s=e.cond(u).then(f,"=",a,".createStream(",i,");").else(f,"=",a,".getElements(",i,");");return te.optional((function(){e.assert(s.else,"!"+i+"||"+f,"invalid elements")})),t.entry(s),t.exit(e.cond(u).then(a,".destroyStream(",f,");")),e.ELEMENTS=f,f}))}return null}var o=a();function f(){if(Bi in r){var e=r[Bi];return te.commandParameter(e,Nt,"invalid primitve",t.commandStr),Zo((function(t,r){return Nt[e]}))}if(Bi in n){var a=n[Bi];return Ko(a,(function(e,t){var r=e.constants.primTypes,n=e.invoke(t,a);return te.optional((function(){e.assert(t,n+" in "+r,"invalid primitive, must be one of "+Object.keys(Nt))})),t.def(r,"[",n,"]")}))}return o?Jo(o)?o.value?Zo((function(e,t){return t.def(e.ELEMENTS,".primType")})):Zo((function(){return Eo})):new Xo(o.thisDep,o.contextDep,o.propDep,(function(e,t){var r=e.ELEMENTS;return t.def(r,"?",r,".primType:",Eo)})):null}function u(e,a){if(e in r){var i=0|r[e];return te.command(!a||i>=0,"invalid "+e,t.commandStr),Zo((function(e,t){return a&&(e.OFFSET=i),i}))}if(e in n){var f=n[e];return Ko(f,(function(t,r){var n=t.invoke(r,f);return a&&(t.OFFSET=n,te.optional((function(){t.assert(r,n+">=0","invalid "+e)}))),n}))}return a&&o?Zo((function(e,t){return e.OFFSET="0",0})):null}var s=u(Ii,!0);function c(){if(Li in r){var e=0|r[Li];return te.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),Zo((function(){return e}))}if(Li in n){var a=n[Li];return Ko(a,(function(e,t){var r=e.invoke(t,a);return te.optional((function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")})),r}))}if(o){if(Jo(o)){if(o)return s?new Xo(s.thisDep,s.contextDep,s.propDep,(function(e,t){var r=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return te.optional((function(){e.assert(t,r+">=0","invalid vertex offset/element buffer too small")})),r})):Zo((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var i=Zo((function(){return-1}));return te.optional((function(){i.MISSING=!0})),i}var f=new Xo(o.thisDep||s.thisDep,o.contextDep||s.contextDep,o.propDep||s.propDep,(function(e,t){var r=e.ELEMENTS;return e.OFFSET?t.def(r,"?",r,".vertCount-",e.OFFSET,":-1"):t.def(r,"?",r,".vertCount:-1")}));return te.optional((function(){f.DYNAMIC=!0})),f}return null}return{elements:o,primitive:f(),count:c(),instances:u(Ri,!1),offset:s}}function B(e,t){var r=e.static,a=e.dynamic,i={};return w.forEach((function(e){var o=A(e);function f(t,n){if(e in r){var f=t(r[e]);i[o]=Zo((function(){return f}))}else if(e in a){var u=a[e];i[o]=Ko(u,(function(e,t){return n(e,t,e.invoke(t,u))}))}}switch(e){case di:case ii:case ai:case Mi:case si:case Ti:case gi:case xi:case wi:case hi:return f((function(r){return te.commandType(r,"boolean",e,t.commandStr),r}),(function(t,r,n){return te.optional((function(){t.assert(r,"typeof "+n+'==="boolean"',"invalid flag "+e,t.commandStr)})),n}));case ci:return f((function(r){return te.commandParameter(r,Uo,"invalid "+e,t.commandStr),Uo[r]}),(function(t,r,n){var a=t.constants.compareFuncs;return te.optional((function(){t.assert(r,n+" in "+a,"invalid "+e+", must be one of "+Object.keys(Uo))})),r.def(a,"[",n,"]")}));case li:return f((function(e){return te.command(fr(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,r){return te.optional((function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===2&&typeof "+r+'[0]==="number"&&typeof '+r+'[1]==="number"&&'+r+"[0]<="+r+"[1]","depth range must be a 2d array")})),[t.def("+",r,"[0]"),t.def("+",r,"[1]")]}));case ui:return f((function(e){te.commandType(e,"object","blend.func",t.commandStr);var r="srcRGB"in e?e.srcRGB:e.src,n="srcAlpha"in e?e.srcAlpha:e.src,a="dstRGB"in e?e.dstRGB:e.dst,i="dstAlpha"in e?e.dstAlpha:e.dst;return te.commandParameter(r,Ho,o+".srcRGB",t.commandStr),te.commandParameter(n,Ho,o+".srcAlpha",t.commandStr),te.commandParameter(a,Ho,o+".dstRGB",t.commandStr),te.commandParameter(i,Ho,o+".dstAlpha",t.commandStr),te.command(-1===No.indexOf(r+", "+a),"unallowed blending combination (srcRGB, dstRGB) = ("+r+", "+a+")",t.commandStr),[Ho[r],Ho[a],Ho[n],Ho[i]]}),(function(t,r,n){var a=t.constants.blendFuncs;function i(i,o){var f=r.def('"',i,o,'" in ',n,"?",n,".",i,o,":",n,".",i);return te.optional((function(){t.assert(r,f+" in "+a,"invalid "+e+"."+i+o+", must be one of "+Object.keys(Ho))})),f}te.optional((function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid blend func, must be an object")}));var o=i("src","RGB"),f=i("dst","RGB");te.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(r,e+".indexOf("+o+'+", "+'+f+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=r.def(a,"[",o,"]"),s=r.def(a,"[",i("src","Alpha"),"]");return[u,r.def(a,"[",f,"]"),s,r.def(a,"[",i("dst","Alpha"),"]")]}));case fi:return f((function(r){return"string"==typeof r?(te.commandParameter(r,b,"invalid "+e,t.commandStr),[b[r],b[r]]):"object"==typeof r?(te.commandParameter(r.rgb,b,e+".rgb",t.commandStr),te.commandParameter(r.alpha,b,e+".alpha",t.commandStr),[b[r.rgb],b[r.alpha]]):void te.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,r,n){var a=t.constants.blendEquations,i=r.def(),o=r.def(),f=t.cond("typeof ",n,'==="string"');return te.optional((function(){function r(e,r,n){t.assert(e,n+" in "+a,"invalid "+r+", must be one of "+Object.keys(b))}r(f.then,e,n),t.assert(f.else,n+"&&typeof "+n+'==="object"',"invalid "+e),r(f.else,e+".rgb",n+".rgb"),r(f.else,e+".alpha",n+".alpha")})),f.then(i,"=",o,"=",a,"[",n,"];"),f.else(i,"=",a,"[",n,".rgb];",o,"=",a,"[",n,".alpha];"),r(f),[i,o]}));case oi:return f((function(e){return te.command(fr(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),Me(4,(function(t){return+e[t]}))}),(function(e,t,r){return te.optional((function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","blend.color must be a 4d array")})),Me(4,(function(e){return t.def("+",r,"[",e,"]")}))}));case Ai:return f((function(e){return te.commandType(e,"number",o,t.commandStr),0|e}),(function(e,t,r){return te.optional((function(){e.assert(t,"typeof "+r+'==="number"',"invalid stencil.mask")})),t.def(r,"|0")}));case _i:return f((function(r){te.commandType(r,"object",o,t.commandStr);var n=r.cmp||"keep",a=r.ref||0,i="mask"in r?r.mask:-1;return te.commandParameter(n,Uo,e+".cmp",t.commandStr),te.commandType(a,"number",e+".ref",t.commandStr),te.commandType(i,"number",e+".mask",t.commandStr),[Uo[n],a,i]}),(function(e,t,r){var n=e.constants.compareFuncs;return te.optional((function(){function a(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}a(r+"&&typeof ",r,'==="object"'),a('!("cmp" in ',r,")||(",r,".cmp in ",n,")")})),[t.def('"cmp" in ',r,"?",n,"[",r,".cmp]",":",zo),t.def(r,".ref|0"),t.def('"mask" in ',r,"?",r,".mask|0:-1")]}));case Si:case Ei:return f((function(r){te.commandType(r,"object",o,t.commandStr);var n=r.fail||"keep",a=r.zfail||"keep",i=r.zpass||"keep";return te.commandParameter(n,Wo,e+".fail",t.commandStr),te.commandParameter(a,Wo,e+".zfail",t.commandStr),te.commandParameter(i,Wo,e+".zpass",t.commandStr),[e===Ei?jo:To,Wo[n],Wo[a],Wo[i]]}),(function(t,r,n){var a=t.constants.stencilOps;function i(i){return te.optional((function(){t.assert(r,'!("'+i+'" in '+n+")||("+n+"."+i+" in "+a+")","invalid "+e+"."+i+", must be one of "+Object.keys(Wo))})),r.def('"',i,'" in ',n,"?",a,"[",n,".",i,"]:",zo)}return te.optional((function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)})),[e===Ei?jo:To,i("fail"),i("zfail"),i("zpass")]}));case yi:return f((function(e){te.commandType(e,"object",o,t.commandStr);var r=0|e.factor,n=0|e.units;return te.commandType(r,"number",o+".factor",t.commandStr),te.commandType(n,"number",o+".units",t.commandStr),[r,n]}),(function(t,r,n){return te.optional((function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)})),[r.def(n,".factor|0"),r.def(n,".units|0")]}));case mi:return f((function(e){var r=0;return"front"===e?r=To:"back"===e&&(r=jo),te.command(!!r,o,t.commandStr),r}),(function(e,t,r){return te.optional((function(){e.assert(t,r+'==="front"||'+r+'==="back"',"invalid cull.face")})),t.def(r,'==="front"?',To,":",jo)}));case vi:return f((function(e){return te.command("number"==typeof e&&e>=n.lineWidthDims[0]&&e<=n.lineWidthDims[1],"invalid line width, must be a positive number between "+n.lineWidthDims[0]+" and "+n.lineWidthDims[1],t.commandStr),e}),(function(e,t,r){return te.optional((function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">="+n.lineWidthDims[0]+"&&"+r+"<="+n.lineWidthDims[1],"invalid line width")})),r}));case bi:return f((function(e){return te.commandParameter(e,Qo,o,t.commandStr),Qo[e]}),(function(e,t,r){return te.optional((function(){e.assert(t,r+'==="cw"||'+r+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(r+'==="cw"?'+Do+":"+Co)}));case pi:return f((function(e){return te.command(fr(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,r){return te.optional((function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","invalid color.mask")})),Me(4,(function(e){return"!!"+r+"["+e+"]"}))}));case ki:return f((function(e){te.command("object"==typeof e&&e,o,t.commandStr);var r="value"in e?e.value:1,n=!!e.invert;return te.command("number"==typeof r&&r>=0&&r<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[r,n]}),(function(e,t,r){return te.optional((function(){e.assert(t,r+"&&typeof "+r+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',r,"?+",r,".value:1"),t.def("!!",r,".invert")]}))}})),i}function L(e,t){var r=e.static,n=e.dynamic,a={};return Object.keys(r).forEach((function(e){var n,i=r[e];if("number"==typeof i||"boolean"==typeof i)n=Zo((function(){return i}));else if("function"==typeof i){var o=i._reglType;"texture2d"===o||"textureCube"===o?n=Zo((function(e){return e.link(i)})):"framebuffer"===o||"framebufferCube"===o?(te.command(i.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),n=Zo((function(e){return e.link(i.color[0])}))):te.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else fr(i)?n=Zo((function(t){return t.global.def("[",Me(i.length,(function(r){return te.command("number"==typeof i[r]||"boolean"==typeof i[r],"invalid uniform "+e,t.commandStr),i[r]})),"]")})):te.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);n.value=i,a[e]=n})),Object.keys(n).forEach((function(e){var t=n[e];a[e]=Ko(t,(function(e,r){return e.invoke(r,t)}))})),a}function I(e,r){var n=e.static,i=e.dynamic,o={};return Object.keys(n).forEach((function(e){var i=n[e],f=t.id(e),u=new m;if(Yo(i))u.state=Ja,u.buffer=a.getBuffer(a.create(i,Xi,!1,!0)),u.type=0;else{var s=a.getBuffer(i);if(s)u.state=Ja,u.buffer=s,u.type=0;else if(te.command("object"==typeof i&&i,"invalid data for attribute "+e,r.commandStr),"constant"in i){var c=i.constant;u.buffer="null",u.state=Za,"number"==typeof c?u.x=c:(te.command(fr(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+e,r.commandStr),$a.forEach((function(e,t){t<c.length&&(u[e]=c[t])})))}else{s=Yo(i.buffer)?a.getBuffer(a.create(i.buffer,Xi,!1,!0)):a.getBuffer(i.buffer),te.command(!!s,'missing buffer for attribute "'+e+'"',r.commandStr);var l=0|i.offset;te.command(l>=0,'invalid offset for attribute "'+e+'"',r.commandStr);var h=0|i.stride;te.command(h>=0&&h<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',r.commandStr);var p=0|i.size;te.command(!("size"in i)||p>0&&p<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',r.commandStr);var d=!!i.normalized,b=0;"type"in i&&(te.commandParameter(i.type,Dt,"invalid type for attribute "+e,r.commandStr),b=Dt[i.type]);var g=0|i.divisor;"divisor"in i&&(te.command(0===g||v,'cannot specify divisor for attribute "'+e+'", instancing not supported',r.commandStr),te.command(g>=0,'invalid divisor for attribute "'+e+'"',r.commandStr)),te.optional((function(){var t=r.commandStr,n=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(r){te.command(n.indexOf(r)>=0,'unknown parameter "'+r+'" for attribute pointer "'+e+'" (valid parameters are '+n+")",t)}))})),u.buffer=s,u.state=Ja,u.size=p,u.normalized=d,u.type=b||s.dtype,u.offset=l,u.stride=h,u.divisor=g}}o[e]=Zo((function(e,t){var r=e.attribCache;if(f in r)return r[f];var n={isStream:!1};return Object.keys(u).forEach((function(e){n[e]=u[e]})),u.buffer&&(n.buffer=e.link(u.buffer),n.type=n.type||n.buffer+".dtype"),r[f]=n,n}))})),Object.keys(i).forEach((function(e){var t=i[e];function r(r,n){var a=r.invoke(n,t),i=r.shared,o=i.isBufferArgs,f=i.buffer;te.optional((function(){r.assert(n,a+"&&(typeof "+a+'==="object"||typeof '+a+'==="function")&&('+o+"("+a+")||"+f+".getBuffer("+a+")||"+f+".getBuffer("+a+".buffer)||"+o+"("+a+'.buffer)||("constant" in '+a+"&&(typeof "+a+'.constant==="number"||'+i.isArrayLike+"("+a+".constant))))",'invalid dynamic attribute "'+e+'"')}));var u={isStream:n.def(!1)},s=new m;s.state=Ja,Object.keys(s).forEach((function(e){u[e]=n.def(""+s[e])}));var c=u.buffer,l=u.type;function h(e){n(u[e],"=",a,".",e,"|0;")}return n("if(",o,"(",a,")){",u.isStream,"=true;",c,"=",f,".createStream(",Xi,",",a,");",l,"=",c,".dtype;","}else{",c,"=",f,".getBuffer(",a,");","if(",c,"){",l,"=",c,".dtype;",'}else if("constant" in ',a,"){",u.state,"=",Za,";","if(typeof "+a+'.constant === "number"){',u[$a[0]],"=",a,".constant;",$a.slice(1).map((function(e){return u[e]})).join("="),"=0;","}else{",$a.map((function(e,t){return u[e]+"="+a+".constant.length>"+t+"?"+a+".constant["+t+"]:0;"})).join(""),"}}else{","if(",o,"(",a,".buffer)){",c,"=",f,".createStream(",Xi,",",a,".buffer);","}else{",c,"=",f,".getBuffer(",a,".buffer);","}",l,'="type" in ',a,"?",i.glTypes,"[",a,".type]:",c,".dtype;",u.normalized,"=!!",a,".normalized;"),h("size"),h("offset"),h("stride"),h("divisor"),n("}}"),n.exit("if(",u.isStream,"){",f,".destroyStream(",c,");","}"),u}o[e]=Ko(t,r)})),o}function R(e){var t=e.static,r=e.dynamic,n={};return Object.keys(t).forEach((function(e){var r=t[e];n[e]=Zo((function(e,t){return"number"==typeof r||"boolean"==typeof r?""+r:e.link(r)}))})),Object.keys(r).forEach((function(e){var t=r[e];n[e]=Ko(t,(function(e,r){return e.invoke(r,t)}))})),n}function q(e,t,r,n,a){var i=e.static,o=e.dynamic;te.optional((function(){var e=[Oi,Pi,Fi,zi,Bi,Ii,Li,Ri,Ci].concat(w);function t(t){Object.keys(t).forEach((function(t){te.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',a.commandStr)}))}t(i),t(o)}));var f=O(e),u=P(e,f,a),s=z(e,a),c=B(e,a),l=F(e);function h(e){var t=u[e];t&&(c[e]=t)}h(Di),h(A(ji));var p=Object.keys(c).length>0,d={framebuffer:f,draw:s,shader:l,state:c,dirty:p};return d.profile=C(e),d.uniforms=L(r,a),d.attributes=I(t,a),d.context=R(n),d}function G(e,t,r){var n=e.shared.context,a=e.scope();Object.keys(r).forEach((function(i){t.save(n,"."+i);var o=r[i];a(n,".",i,"=",o.append(e,t),";")})),t(a)}function H(e,t,r,n){var a,i=e.shared,o=i.gl,f=i.framebuffer;g&&(a=t.def(i.extensions,".webgl_draw_buffers"));var u,s=e.constants,c=s.drawBuffer,l=s.backBuffer;u=r?r.append(e,t):t.def(f,".next"),n||t("if(",u,"!==",f,".cur){"),t("if(",u,"){",o,".bindFramebuffer(",qo,",",u,".framebuffer);"),g&&t(a,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",o,".bindFramebuffer(",qo,",null);"),g&&t(a,".drawBuffersWEBGL(",l,");"),t("}",f,".cur=",u,";"),n||t("}")}function N(e,t,r){var n=e.shared,a=n.gl,i=e.current,o=e.next,f=n.current,u=n.next,s=e.cond(f,".dirty");w.forEach((function(t){var n,c,l=A(t);if(!(l in r.state))if(l in o){n=o[l],c=i[l];var h=Me(y[l].length,(function(e){return s.def(n,"[",e,"]")}));s(e.cond(h.map((function(e,t){return e+"!=="+c+"["+t+"]"})).join("||")).then(a,".",M[l],"(",h,");",h.map((function(e,t){return c+"["+t+"]="+e})).join(";"),";"))}else{n=s.def(u,".",l);var p=e.cond(n,"!==",f,".",l);s(p),l in k?p(e.cond(n).then(a,".enable(",k[l],");").else(a,".disable(",k[l],");"),f,".",l,"=",n,";"):p(a,".",M[l],"(",n,");",f,".",l,"=",n,";")}})),0===Object.keys(r.state).length&&s(f,".dirty=false;"),t(s)}function U(e,t,r,n){var a=e.shared,i=e.current,o=a.current,f=a.gl;$o(Object.keys(r)).forEach((function(a){var u=r[a];if(!n||n(u)){var s=u.append(e,t);if(k[a]){var c=k[a];Jo(u)?t(f,s?".enable(":".disable(",c,");"):t(e.cond(s).then(f,".enable(",c,");").else(f,".disable(",c,");")),t(o,".",a,"=",s,";")}else if(fr(s)){var l=i[a];t(f,".",M[a],"(",s,");",s.map((function(e,t){return l+"["+t+"]="+e})).join(";"),";")}else t(f,".",M[a],"(",s,");",o,".",a,"=",s,";")}}))}function W(e,t){v&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function V(e,t,r,n,a){var i,o,f,u=e.shared,s=e.stats,c=u.current,l=u.timer,h=r.profile;function d(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function m(e){e(i=t.def(),"=",d(),";"),"string"==typeof a?e(s,".count+=",a,";"):e(s,".count++;"),p&&(n?e(o=t.def(),"=",l,".getNumPendingQueries();"):e(l,".beginQuery(",s,");"))}function b(e){e(s,".cpuTime+=",d(),"-",i,";"),p&&(n?e(l,".pushScopeStats(",o,",",l,".getNumPendingQueries(),",s,");"):e(l,".endQuery();"))}function v(e){var r=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",r,";")}if(h){if(Jo(h))return void(h.enable?(m(t),b(t.exit),v("true")):v("false"));v(f=h.append(e,t))}else f=t.def(c,".profile");var g=e.block();m(g),t("if(",f,"){",g,"}");var y=e.block();b(y),t.exit("if(",f,"){",y,"}")}function Q(e,t,r,n,a){var i=e.shared;function o(e){switch(e){case co:case mo:case yo:return 2;case lo:case bo:case xo:return 3;case ho:case vo:case wo:return 4;default:return 1}}function f(r,n,a){var o=i.gl,f=t.def(r,".location"),u=t.def(i.attributes,"[",f,"]"),s=a.state,c=a.buffer,l=[a.x,a.y,a.z,a.w],h=["buffer","normalized","offset","stride"];function p(){t("if(!",u,".buffer){",o,".enableVertexAttribArray(",f,");}");var r,i=a.type;if(r=a.size?t.def(a.size,"||",n):n,t("if(",u,".type!==",i,"||",u,".size!==",r,"||",h.map((function(e){return u+"."+e+"!=="+a[e]})).join("||"),"){",o,".bindBuffer(",Xi,",",c,".buffer);",o,".vertexAttribPointer(",[f,r,i,a.normalized,a.stride,a.offset],");",u,".type=",i,";",u,".size=",r,";",h.map((function(e){return u+"."+e+"="+a[e]+";"})).join(""),"}"),v){var s=a.divisor;t("if(",u,".divisor!==",s,"){",e.instancing,".vertexAttribDivisorANGLE(",[f,s],");",u,".divisor=",s,";}")}}function d(){t("if(",u,".buffer){",o,".disableVertexAttribArray(",f,");","}if(",$a.map((function(e,t){return u+"."+e+"!=="+l[t]})).join("||"),"){",o,".vertexAttrib4f(",f,",",l,");",$a.map((function(e,t){return u+"."+e+"="+l[t]+";"})).join(""),"}")}s===Ja?p():s===Za?d():(t("if(",s,"===",Ja,"){"),p(),t("}else{"),d(),t("}"))}n.forEach((function(n){var i,u=n.name,s=r.attributes[u];if(s){if(!a(s))return;i=s.append(e,t)}else{if(!a(ef))return;var c=e.scopeAttrib(u);te.optional((function(){e.assert(t,c+".state","missing attribute "+u)})),i={},Object.keys(new m).forEach((function(e){i[e]=t.def(c,".",e)}))}f(e.link(n),o(n.info.type),i)}))}function Y(e,r,n,a,i){for(var o,f=e.shared,u=f.gl,s=0;s<a.length;++s){var c,l=a[s],h=l.name,p=l.info.type,d=n.uniforms[h],m=e.link(l)+".location";if(d){if(!i(d))continue;if(Jo(d)){var b=d.value;if(te.command(null!=b,'missing uniform "'+h+'"',e.commandStr),p===_o||p===So){te.command("function"==typeof b&&(p===_o&&("texture2d"===b._reglType||"framebuffer"===b._reglType)||p===So&&("textureCube"===b._reglType||"framebufferCube"===b._reglType)),"invalid texture for uniform "+h,e.commandStr);var v=e.link(b._texture||b.color[0]._texture);r(u,".uniform1i(",m,",",v+".bind());"),r.exit(v,".unbind();")}else if(p===ko||p===Mo||p===Ao){te.optional((function(){te.command(fr(b),"invalid matrix for uniform "+h,e.commandStr),te.command(p===ko&&4===b.length||p===Mo&&9===b.length||p===Ao&&16===b.length,"invalid length for matrix uniform "+h,e.commandStr)}));var g=e.global.def("new Float32Array(["+Array.prototype.slice.call(b)+"])"),y=2;p===Mo?y=3:p===Ao&&(y=4),r(u,".uniformMatrix",y,"fv(",m,",false,",g,");")}else{switch(p){case so:te.commandType(b,"number","uniform "+h,e.commandStr),o="1f";break;case co:te.command(fr(b)&&2===b.length,"uniform "+h,e.commandStr),o="2f";break;case lo:te.command(fr(b)&&3===b.length,"uniform "+h,e.commandStr),o="3f";break;case ho:te.command(fr(b)&&4===b.length,"uniform "+h,e.commandStr),o="4f";break;case go:te.commandType(b,"boolean","uniform "+h,e.commandStr),o="1i";break;case po:te.commandType(b,"number","uniform "+h,e.commandStr),o="1i";break;case yo:case mo:te.command(fr(b)&&2===b.length,"uniform "+h,e.commandStr),o="2i";break;case xo:case bo:te.command(fr(b)&&3===b.length,"uniform "+h,e.commandStr),o="3i";break;case wo:case vo:te.command(fr(b)&&4===b.length,"uniform "+h,e.commandStr),o="4i"}r(u,".uniform",o,"(",m,",",fr(b)?Array.prototype.slice.call(b):b,");")}continue}c=d.append(e,r)}else{if(!i(ef))continue;c=r.def(f.uniforms,"[",t.id(h),"]")}p===_o?r("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}"):p===So&&r("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}"),te.optional((function(){function t(t,n){e.assert(r,t,'bad data or missing for uniform "'+h+'".  '+n)}function n(e){t("typeof "+c+'==="'+e+'"',"invalid type, expected "+e)}function a(r,n){t(f.isArrayLike+"("+c+")&&"+c+".length==="+r,"invalid vector, should have length "+r,e.commandStr)}function i(r){t("typeof "+c+'==="function"&&'+c+'._reglType==="texture'+(r===Zi?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(p){case po:case so:n("number");break;case mo:case co:case yo:a(2);break;case bo:case lo:case xo:a(3);break;case vo:case ho:case wo:case ko:a(4);break;case go:n("boolean");break;case Mo:a(9);break;case Ao:a(16);break;case _o:i(Zi);break;case So:i(Ki)}}));var x=1;switch(p){case _o:case So:var w=r.def(c,"._texture");r(u,".uniform1i(",m,",",w,".bind());"),r.exit(w,".unbind();");continue;case po:case go:o="1i";break;case mo:case yo:o="2i",x=2;break;case bo:case xo:o="3i",x=3;break;case vo:case wo:o="4i",x=4;break;case so:o="1f";break;case co:o="2f",x=2;break;case lo:o="3f",x=3;break;case ho:o="4f",x=4;break;case ko:o="Matrix2fv";break;case Mo:o="Matrix3fv";break;case Ao:o="Matrix4fv"}if(r(u,".uniform",o,"(",m,","),"M"===o.charAt(0)){var k=Math.pow(p-ko+2,2),M=e.global.def("new Float32Array(",k,")");r("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",Me(k,(function(e){return M+"["+e+"]="+c+"["+e+"]"})),",",M,")")}else r(x>1?Me(x,(function(e){return c+"["+e+"]"})):c);r(");")}}function $(e,t,r,n){var a=e.shared,i=a.gl,o=a.draw,f=n.draw;function u(){var a,u=f.elements,s=t;return u?((u.contextDep&&n.contextDynamic||u.propDep)&&(s=r),a=u.append(e,s)):a=s.def(o,".",zi),a&&s("if("+a+")"+i+".bindBuffer("+Ji+","+a+".buffer.buffer);"),a}function s(){var a,i=f.count,u=t;return i?((i.contextDep&&n.contextDynamic||i.propDep)&&(u=r),a=i.append(e,u),te.optional((function(){i.MISSING&&e.assert(t,"false","missing vertex count"),i.DYNAMIC&&e.assert(u,a+">=0","missing vertex count")}))):(a=u.def(o,".",Li),te.optional((function(){e.assert(u,a+">=0","missing vertex count")}))),a}var c=u();function l(a){var i=f[a];return i?i.contextDep&&n.contextDynamic||i.propDep?i.append(e,r):i.append(e,t):t.def(o,".",a)}var h,p,d=l(Bi),m=l(Ii),b=s();if("number"==typeof b){if(0===b)return}else r("if(",b,"){"),r.exit("}");v&&(h=l(Ri),p=e.instancing);var g=c+".type",y=f.elements&&Jo(f.elements);function x(){function e(){r(p,".drawElementsInstancedANGLE(",[d,b,g,m+"<<(("+g+"-"+Xa+")>>1)",h],");")}function t(){r(p,".drawArraysInstancedANGLE(",[d,m,b,h],");")}c?y?e():(r("if(",c,"){"),e(),r("}else{"),t(),r("}")):t()}function w(){function e(){r(i+".drawElements("+[d,b,g,m+"<<(("+g+"-"+Xa+")>>1)"]+");")}function t(){r(i+".drawArrays("+[d,m,b]+");")}c?y?e():(r("if(",c,"){"),e(),r("}else{"),t(),r("}")):t()}v&&("number"!=typeof h||h>=0)?"string"==typeof h?(r("if(",h,">0){"),x(),r("}else if(",h,"<0){"),w(),r("}")):x():w()}function X(e,t,r,n,a){var i=D(),o=i.proc("body",a);return te.optional((function(){i.commandStr=t.commandStr,i.command=i.link(t.commandStr)})),v&&(i.instancing=o.def(i.shared.extensions,".angle_instanced_arrays")),e(i,o,r,n),i.compile().body}function J(e,t,r,n){W(e,t),Q(e,t,r,n.attributes,(function(){return!0})),Y(e,t,r,n.uniforms,(function(){return!0})),$(e,t,t,r)}function Z(e,t){var r=e.proc("draw",1);W(e,r),G(e,r,t.context),H(e,r,t.framebuffer),N(e,r,t),U(e,r,t.state),V(e,r,t,!1,!0);var n=t.shader.progVar.append(e,r);if(r(e.shared.gl,".useProgram(",n,".program);"),t.shader.program)J(e,r,t,t.shader.program);else{var a=e.global.def("{}"),i=r.def(n,".id"),o=r.def(a,"[",i,"]");r(e.cond(o).then(o,".call(this,a0);").else(o,"=",a,"[",i,"]=",e.link((function(r){return X(J,e,t,r,1)})),"(",n,");",o,".call(this,a0);"))}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}function K(e,t,r,n){function a(){return!0}e.batchId="a1",W(e,t),Q(e,t,r,n.attributes,a),Y(e,t,r,n.uniforms,a),$(e,t,t,r)}function ee(e,t,r,n){W(e,t);var a=r.contextDep,i=t.def(),o="a0",f="a1",u=t.def();e.shared.props=u,e.batchId=i;var s=e.scope(),c=e.scope();function l(e){return e.contextDep&&a||e.propDep}function h(e){return!l(e)}if(t(s.entry,"for(",i,"=0;",i,"<",f,";++",i,"){",u,"=",o,"[",i,"];",c,"}",s.exit),r.needsContext&&G(e,c,r.context),r.needsFramebuffer&&H(e,c,r.framebuffer),U(e,c,r.state,l),r.profile&&l(r.profile)&&V(e,c,r,!1,!0),n)Q(e,s,r,n.attributes,h),Q(e,c,r,n.attributes,l),Y(e,s,r,n.uniforms,h),Y(e,c,r,n.uniforms,l),$(e,s,c,r);else{var p=e.global.def("{}"),d=r.shader.progVar.append(e,c),m=c.def(d,".id"),b=c.def(p,"[",m,"]");c(e.shared.gl,".useProgram(",d,".program);","if(!",b,"){",b,"=",p,"[",m,"]=",e.link((function(t){return X(K,e,r,t,2)})),"(",d,");}",b,".call(this,a0[",i,"],",i,");")}}function re(e,t){var r=e.proc("batch",2);e.batchId="0",W(e,r);var n=!1,a=!0;Object.keys(t.context).forEach((function(e){n=n||t.context[e].propDep})),n||(G(e,r,t.context),a=!1);var i=t.framebuffer,o=!1;function f(e){return e.contextDep&&n||e.propDep}i?(i.propDep?n=o=!0:i.contextDep&&n&&(o=!0),o||H(e,r,i)):H(e,r,null),t.state.viewport&&t.state.viewport.propDep&&(n=!0),N(e,r,t),U(e,r,t.state,(function(e){return!f(e)})),t.profile&&f(t.profile)||V(e,r,t,!1,"a1"),t.contextDep=n,t.needsContext=a,t.needsFramebuffer=o;var u=t.shader.progVar;if(u.contextDep&&n||u.propDep)ee(e,r,t,null);else{var s=u.append(e,r);if(r(e.shared.gl,".useProgram(",s,".program);"),t.shader.program)ee(e,r,t,t.shader.program);else{var c=e.global.def("{}"),l=r.def(s,".id"),h=r.def(c,"[",l,"]");r(e.cond(h).then(h,".call(this,a0,a1);").else(h,"=",c,"[",l,"]=",e.link((function(r){return X(ee,e,t,r,2)})),"(",s,");",h,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}function ne(e,r){var n=e.proc("scope",3);e.batchId="a2";var a=e.shared,i=a.current;function o(t){var i=r.shader[t];i&&n.set(a.shader,"."+t,i.append(e,n))}G(e,n,r.context),r.framebuffer&&r.framebuffer.append(e,n),$o(Object.keys(r.state)).forEach((function(t){var i=r.state[t].append(e,n);fr(i)?i.forEach((function(r,a){n.set(e.next[t],"["+a+"]",r)})):n.set(a.next,"."+t,i)})),V(e,n,r,!0,!0),[zi,Ii,Li,Ri,Bi].forEach((function(t){var i=r.draw[t];i&&n.set(a.draw,"."+t,""+i.append(e,n))})),Object.keys(r.uniforms).forEach((function(i){n.set(a.uniforms,"["+t.id(i)+"]",r.uniforms[i].append(e,n))})),Object.keys(r.attributes).forEach((function(t){var a=r.attributes[t].append(e,n),i=e.scopeAttrib(t);Object.keys(new m).forEach((function(e){n.set(i,"."+e,a[e])}))})),o(Pi),o(Fi),Object.keys(r.state).length>0&&(n(i,".dirty=true;"),n.exit(i,".dirty=true;")),n("a1(",e.shared.context,",a0,",e.batchId,");")}function ae(e){if("object"==typeof e&&!fr(e)){for(var t=Object.keys(e),r=0;r<t.length;++r)if(le.isDynamic(e[t[r]]))return!0;return!1}}function ie(e,t,r){var n=t.static[r];if(n&&ae(n)){var a=e.global,i=Object.keys(n),o=!1,f=!1,u=!1,s=e.global.def("{}");i.forEach((function(t){var r=n[t];if(le.isDynamic(r)){"function"==typeof r&&(r=n[t]=le.unbox(r));var i=Ko(r,null);o=o||i.thisDep,u=u||i.propDep,f=f||i.contextDep}else{switch(a(s,".",t,"="),typeof r){case"number":a(r);break;case"string":a('"',r,'"');break;case"object":Array.isArray(r)&&a("[",r.join(),"]");break;default:a(e.link(r))}a(";")}})),t.dynamic[r]=new le.DynamicVariable(ni,{thisDep:o,contextDep:f,propDep:u,ref:s,append:c}),delete t.static[r]}function c(e,t){i.forEach((function(r){var a=n[r];if(le.isDynamic(a)){var i=e.invoke(t,a);t(s,".",r,"=",i,";")}}))}}function oe(e,t,r,n,a){var i=D();i.stats=i.link(a),Object.keys(t.static).forEach((function(e){ie(i,t,e)})),$i.forEach((function(t){ie(i,e,t)}));var o=q(e,t,r,n,i);return Z(i,o),ne(i,o),re(i,o),i.compile()}return{next:x,current:y,procs:function(){var e=D(),t=e.proc("poll"),r=e.proc("refresh"),a=e.block();t(a),r(a);var i,o=e.shared,f=o.gl,u=o.next,s=o.current;a(s,".dirty=false;"),H(e,t),H(e,r,null,!0),v&&(i=e.link(v));for(var c=0;c<n.maxAttributes;++c){var l=r.def(o.attributes,"[",c,"]"),h=e.cond(l,".buffer");h.then(f,".enableVertexAttribArray(",c,");",f,".bindBuffer(",Xi,",",l,".buffer.buffer);",f,".vertexAttribPointer(",c,",",l,".size,",l,".type,",l,".normalized,",l,".stride,",l,".offset);").else(f,".disableVertexAttribArray(",c,");",f,".vertexAttrib4f(",c,",",l,".x,",l,".y,",l,".z,",l,".w);",l,".buffer=null;"),r(h),v&&r(i,".vertexAttribDivisorANGLE(",c,",",l,".divisor);")}return Object.keys(k).forEach((function(n){var i=k[n],o=a.def(u,".",n),c=e.block();c("if(",o,"){",f,".enable(",i,")}else{",f,".disable(",i,")}",s,".",n,"=",o,";"),r(c),t("if(",o,"!==",s,".",n,"){",c,"}")})),Object.keys(M).forEach((function(n){var i,o,c=M[n],l=y[n],h=e.block();if(h(f,".",c,"("),fr(l)){var p=l.length;i=e.global.def(u,".",n),o=e.global.def(s,".",n),h(Me(p,(function(e){return i+"["+e+"]"})),");",Me(p,(function(e){return o+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",Me(p,(function(e){return i+"["+e+"]!=="+o+"["+e+"]"})).join("||"),"){",h,"}")}else i=a.def(u,".",n),o=a.def(s,".",n),h(i,");",s,".",n,"=",i,";"),t("if(",i,"!==",o,"){",h,"}");r(h)})),e.compile()}(),compile:oe}}function rf(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var nf=34918,af=34919,of=35007,ff=function(e,t){var r=t.ext_disjoint_timer_query;if(!r)return null;var n=[];function a(){return n.pop()||r.createQueryEXT()}function i(e){n.push(e)}var o=[];function f(e){var t=a();r.beginQueryEXT(of,t),o.push(t),d(o.length-1,o.length,e)}function u(){r.endQueryEXT(of)}function s(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var c=[];function l(){return c.pop()||new s}function h(e){c.push(e)}var p=[];function d(e,t,r){var n=l();n.startQueryIndex=e,n.endQueryIndex=t,n.sum=0,n.stats=r,p.push(n)}var m=[],b=[];function v(){var e,t,n=o.length;if(0!==n){b.length=Math.max(b.length,n+1),m.length=Math.max(m.length,n+1),m[0]=0,b[0]=0;var a=0;for(e=0,t=0;t<o.length;++t){var f=o[t];r.getQueryObjectEXT(f,af)?(a+=r.getQueryObjectEXT(f,nf),i(f)):o[e++]=f,m[t+1]=a,b[t+1]=e}for(o.length=e,e=0,t=0;t<p.length;++t){var u=p[t],s=u.startQueryIndex,c=u.endQueryIndex;u.sum+=m[c]-m[s];var l=b[s],d=b[c];d===l?(u.stats.gpuTime+=u.sum/1e6,h(u)):(u.startQueryIndex=l,u.endQueryIndex=d,p[e++]=u)}p.length=e}}return{beginQuery:f,endQuery:u,pushScopeStats:d,update:v,getNumPendingQueries:function(){return o.length},clear:function(){n.push.apply(n,o);for(var e=0;e<n.length;e++)r.deleteQueryEXT(n[e]);o.length=0,n.length=0},restore:function(){o.length=0,n.length=0}}},uf=16384,sf=256,cf=1024,lf=34962,hf="webglcontextlost",pf="webglcontextrestored",df=1,mf=2,bf=3;function vf(e,t){for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}function gf(e){var r=we(e);if(!r)return null;var n=r.gl,a=n.getContextAttributes(),i=n.isContextLost(),o=ke(n,r);if(!o)return null;var f=de(),u=rf(),s=o.extensions,c=ff(n,s),l=pe(),h=n.drawingBufferWidth,p=n.drawingBufferHeight,d={tick:0,time:0,viewportWidth:h,viewportHeight:p,framebufferWidth:h,framebufferHeight:p,drawingBufferWidth:h,drawingBufferHeight:p,pixelRatio:r.pixelRatio},m={},b={elements:null,primitive:4,count:-1,offset:0,instances:-1},v=yt(n,s),g=za(n,s,v),y=Ht(n,u,r,g),x=rr(n,s,y,u),w=qa(n,f,u,r),k=Un(n,s,v,(function(){_.procs.poll()}),d,u,r),M=aa(n,s,v,u,r),A=Oa(n,s,v,k,M,u),_=tf(n,f,s,v,y,x,k,A,m,g,w,b,d,c,r),S=Wa(n,A,_.procs.poll,d,a,s,v),E=_.next,T=n.canvas,j=[],D=[],C=[],O=[r.onDestroy],P=null;function F(){if(0===j.length)return c&&c.update(),void(P=null);P=he.next(F),V();for(var e=j.length-1;e>=0;--e){var t=j[e];t&&t(d,null,0)}n.flush(),c&&c.update()}function z(){!P&&j.length>0&&(P=he.next(F))}function B(){P&&(he.cancel(F),P=null)}function L(e){e.preventDefault(),i=!0,B(),D.forEach((function(e){e()}))}function I(e){n.getError(),i=!1,o.restore(),w.restore(),y.restore(),k.restore(),M.restore(),A.restore(),c&&c.restore(),_.procs.refresh(),z(),C.forEach((function(e){e()}))}function R(){j.length=0,B(),T&&(T.removeEventListener(hf,L),T.removeEventListener(pf,I)),w.clear(),A.clear(),M.clear(),k.clear(),x.clear(),y.clear(),c&&c.clear(),O.forEach((function(e){e()}))}function q(e){function r(e){var r=t({},e);function n(e){if(e in r){var t=r[e];delete r[e],Object.keys(t).forEach((function(n){r[e+"."+n]=t[n]}))}}return delete r.uniforms,delete r.attributes,delete r.context,"stencil"in r&&r.stencil.op&&(r.stencil.opBack=r.stencil.opFront=r.stencil.op,delete r.stencil.op),n("blend"),n("depth"),n("cull"),n("stencil"),n("polygonOffset"),n("scissor"),n("sample"),r}function n(e){var t={},r={};return Object.keys(e).forEach((function(n){var a=e[n];le.isDynamic(a)?r[n]=le.unbox(a,n):t[n]=a})),{dynamic:r,static:t}}te(!!e,"invalid args to regl({...})"),te.type(e,"object","invalid args to regl({...})");var a=n(e.context||{}),o=n(e.uniforms||{}),f=n(e.attributes||{}),u=n(r(e)),s={gpuTime:0,cpuTime:0,count:0},c=_.compile(u,f,o,a,s),l=c.draw,h=c.batch,p=c.scope,d=[];function m(e){for(;d.length<e;)d.push(null);return d}function b(e,t){var r;if(i&&te.raise("context lost"),"function"==typeof e)return p.call(this,null,e,0);if("function"==typeof t){if("number"==typeof e){for(r=0;r<e;++r)p.call(this,null,t,r);return}if(Array.isArray(e)){for(r=0;r<e.length;++r)p.call(this,e[r],t,r);return}return p.call(this,e,t,0)}if("number"==typeof e){if(e>0)return h.call(this,m(0|e),0|e)}else{if(!Array.isArray(e))return l.call(this,e);if(e.length)return h.call(this,e,e.length)}}return t(b,{stats:s})}T&&(T.addEventListener(hf,L,!1),T.addEventListener(pf,I,!1));var G=A.setFBO=q({framebuffer:le.define.call(null,df,"framebuffer")});function H(e,t){var r=0;_.procs.poll();var a=t.color;a&&(n.clearColor(+a[0]||0,+a[1]||0,+a[2]||0,+a[3]||0),r|=uf),"depth"in t&&(n.clearDepth(+t.depth),r|=sf),"stencil"in t&&(n.clearStencil(0|t.stencil),r|=cf),te(!!r,"called regl.clear with no buffer specified"),n.clear(r)}function N(e){if(te("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var r=0;r<6;++r)G(t({framebuffer:e.framebuffer.faces[r]},e),H);else G(e,H);else H(null,e)}function U(e){function t(){var t=vf(j,e);function r(){var e=vf(j,r);j[e]=j[j.length-1],j.length-=1,j.length<=0&&B()}te(t>=0,"cannot cancel a frame twice"),j[t]=r}return te.type(e,"function","regl.frame() callback must be a function"),j.push(e),z(),{cancel:t}}function W(){var e=E.viewport,t=E.scissor_box;e[0]=e[1]=t[0]=t[1]=0,d.viewportWidth=d.framebufferWidth=d.drawingBufferWidth=e[2]=t[2]=n.drawingBufferWidth,d.viewportHeight=d.framebufferHeight=d.drawingBufferHeight=e[3]=t[3]=n.drawingBufferHeight}function V(){d.tick+=1,d.time=Y(),W(),_.procs.poll()}function Q(){W(),_.procs.refresh(),c&&c.update()}function Y(){return(pe()-l)/1e3}function $(e,t){var r;switch(te.type(t,"function","listener callback must be a function"),e){case"frame":return U(t);case"lost":r=D;break;case"restore":r=C;break;case"destroy":r=O;break;default:te.raise("invalid event, must be one of frame,lost,restore,destroy")}return r.push(t),{cancel:function(){for(var e=0;e<r.length;++e)if(r[e]===t)return r[e]=r[r.length-1],void r.pop()}}}Q();var X=t(q,{clear:N,prop:le.define.bind(null,df),context:le.define.bind(null,mf),this:le.define.bind(null,bf),draw:q({}),buffer:function(e){return y.create(e,lf,!1,!1)},elements:function(e){return x.create(e,!1)},texture:k.create2D,cube:k.createCube,renderbuffer:M.create,framebuffer:A.create,framebufferCube:A.createCube,attributes:a,frame:U,on:$,limits:v,hasExtension:function(e){return v.extensions.indexOf(e.toLowerCase())>=0},read:S,destroy:R,_gl:n,_refresh:Q,poll:function(){V(),c&&c.update()},now:Y,stats:u});return r.onDone(null,X),X}return gf}()}(bt);var vt=function(e){e=void 0!==e?e:1,Array.isArray(e)||(e=[e,e]);var t=[[-e[0],-e[1],0],[e[0],-e[1],0],[e[0],e[1],0],[-e[0],e[1],0]],r=[0,0,-1],n=[r.slice(),r.slice(),r.slice(),r.slice()];return{positions:t,cells:[[0,1,2],[2,3,0]],uvs:[[0,0],[1,0],[1,1],[0,1]],normals:n}};var gt={rgb2hsl:yt,rgb2hsv:xt,rgb2hwb:wt,rgb2cmyk:kt,rgb2keyword:Mt,rgb2xyz:At,rgb2lab:_t,rgb2lch:function(e){return Pt(_t(e))},hsl2rgb:St,hsl2hsv:function(e){var t=e[0],r=e[1]/100,n=e[2]/100;if(0===n)return[0,0,0];return[t,100*(2*(r*=(n*=2)<=1?n:2-n)/(n+r)),100*((n+r)/2)]},hsl2hwb:function(e){return wt(St(e))},hsl2cmyk:function(e){return kt(St(e))},hsl2keyword:function(e){return Mt(St(e))},hsv2rgb:Et,hsv2hsl:function(e){var t,r,n=e[0],a=e[1]/100,i=e[2]/100;return t=a*i,[n,100*(t=(t/=(r=(2-a)*i)<=1?r:2-r)||0),100*(r/=2)]},hsv2hwb:function(e){return wt(Et(e))},hsv2cmyk:function(e){return kt(Et(e))},hsv2keyword:function(e){return Mt(Et(e))},hwb2rgb:Tt,hwb2hsl:function(e){return yt(Tt(e))},hwb2hsv:function(e){return xt(Tt(e))},hwb2cmyk:function(e){return kt(Tt(e))},hwb2keyword:function(e){return Mt(Tt(e))},cmyk2rgb:jt,cmyk2hsl:function(e){return yt(jt(e))},cmyk2hsv:function(e){return xt(jt(e))},cmyk2hwb:function(e){return wt(jt(e))},cmyk2keyword:function(e){return Mt(jt(e))},keyword2rgb:Bt,keyword2hsl:function(e){return yt(Bt(e))},keyword2hsv:function(e){return xt(Bt(e))},keyword2hwb:function(e){return wt(Bt(e))},keyword2cmyk:function(e){return kt(Bt(e))},keyword2lab:function(e){return _t(Bt(e))},keyword2xyz:function(e){return At(Bt(e))},xyz2rgb:Dt,xyz2lab:Ct,xyz2lch:function(e){return Pt(Ct(e))},lab2xyz:Ot,lab2rgb:Ft,lab2lch:Pt,lch2lab:zt,lch2xyz:function(e){return Ot(zt(e))},lch2rgb:function(e){return Ft(zt(e))}};function yt(e){var t,r,n=e[0]/255,a=e[1]/255,i=e[2]/255,o=Math.min(n,a,i),f=Math.max(n,a,i),u=f-o;return f==o?t=0:n==f?t=(a-i)/u:a==f?t=2+(i-n)/u:i==f&&(t=4+(n-a)/u),(t=Math.min(60*t,360))<0&&(t+=360),r=(o+f)/2,[t,100*(f==o?0:r<=.5?u/(f+o):u/(2-f-o)),100*r]}function xt(e){var t,r,n=e[0],a=e[1],i=e[2],o=Math.min(n,a,i),f=Math.max(n,a,i),u=f-o;return r=0==f?0:u/f*1e3/10,f==o?t=0:n==f?t=(a-i)/u:a==f?t=2+(i-n)/u:i==f&&(t=4+(n-a)/u),(t=Math.min(60*t,360))<0&&(t+=360),[t,r,f/255*1e3/10]}function wt(e){var t=e[0],r=e[1],n=e[2];return[yt(e)[0],100*(1/255*Math.min(t,Math.min(r,n))),100*(n=1-1/255*Math.max(t,Math.max(r,n)))]}function kt(e){var t,r=e[0]/255,n=e[1]/255,a=e[2]/255;return[100*((1-r-(t=Math.min(1-r,1-n,1-a)))/(1-t)||0),100*((1-n-t)/(1-t)||0),100*((1-a-t)/(1-t)||0),100*t]}function Mt(e){return It[JSON.stringify(e)]}function At(e){var t=e[0]/255,r=e[1]/255,n=e[2]/255;return[100*(.4124*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)+.1805*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)),100*(.2126*t+.7152*r+.0722*n),100*(.0193*t+.1192*r+.9505*n)]}function _t(e){var t=At(e),r=t[0],n=t[1],a=t[2];return n/=100,a/=108.883,r=(r/=95.047)>.008856?Math.pow(r,1/3):7.787*r+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(r-n),200*(n-(a=a>.008856?Math.pow(a,1/3):7.787*a+16/116))]}function St(e){var t,r,n,a,i,o=e[0]/360,f=e[1]/100,u=e[2]/100;if(0==f)return[i=255*u,i,i];t=2*u-(r=u<.5?u*(1+f):u+f-u*f),a=[0,0,0];for(var s=0;s<3;s++)(n=o+1/3*-(s-1))<0&&n++,n>1&&n--,i=6*n<1?t+6*(r-t)*n:2*n<1?r:3*n<2?t+(r-t)*(2/3-n)*6:t,a[s]=255*i;return a}function Et(e){var t=e[0]/60,r=e[1]/100,n=e[2]/100,a=Math.floor(t)%6,i=t-Math.floor(t),o=255*n*(1-r),f=255*n*(1-r*i),u=255*n*(1-r*(1-i));n*=255;switch(a){case 0:return[n,u,o];case 1:return[f,n,o];case 2:return[o,n,u];case 3:return[o,f,n];case 4:return[u,o,n];case 5:return[n,o,f]}}function Tt(e){var t,n,a,i,o=e[0]/360,f=e[1]/100,u=e[2]/100,s=f+u;switch(s>1&&(f/=s,u/=s),a=6*o-(t=Math.floor(6*o)),0!=(1&t)&&(a=1-a),i=f+a*((n=1-u)-f),t){default:r=n,g=i,b=f;break;case 1:r=i,g=n,b=f;break;case 2:r=f,g=n,b=i;break;case 3:r=f,g=i,b=n;break;case 4:r=i,g=f,b=n;break;case 5:r=n,g=f,b=i}return[255*r,255*g,255*b]}function jt(e){var t=e[0]/100,r=e[1]/100,n=e[2]/100,a=e[3]/100;return[255*(1-Math.min(1,t*(1-a)+a)),255*(1-Math.min(1,r*(1-a)+a)),255*(1-Math.min(1,n*(1-a)+a))]}function Dt(e){var t,r,n,a=e[0]/100,i=e[1]/100,o=e[2]/100;return r=-.9689*a+1.8758*i+.0415*o,n=.0557*a+-.204*i+1.057*o,t=(t=3.2406*a+-1.5372*i+-.4986*o)>.0031308?1.055*Math.pow(t,1/2.4)-.055:t*=12.92,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r*=12.92,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n*=12.92,[255*(t=Math.min(Math.max(0,t),1)),255*(r=Math.min(Math.max(0,r),1)),255*(n=Math.min(Math.max(0,n),1))]}function Ct(e){var t=e[0],r=e[1],n=e[2];return r/=100,n/=108.883,t=(t/=95.047)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(t-r),200*(r-(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116))]}function Ot(e){var t,r,n,a,i=e[0],o=e[1],f=e[2];return i<=8?a=(r=100*i/903.3)/100*7.787+16/116:(r=100*Math.pow((i+16)/116,3),a=Math.pow(r/100,1/3)),[t=t/95.047<=.008856?t=95.047*(o/500+a-16/116)/7.787:95.047*Math.pow(o/500+a,3),r,n=n/108.883<=.008859?n=108.883*(a-f/200-16/116)/7.787:108.883*Math.pow(a-f/200,3)]}function Pt(e){var t,r=e[0],n=e[1],a=e[2];return(t=360*Math.atan2(a,n)/2/Math.PI)<0&&(t+=360),[r,Math.sqrt(n*n+a*a),t]}function Ft(e){return Dt(Ot(e))}function zt(e){var t,r=e[0],n=e[1];return t=e[2]/360*2*Math.PI,[r,n*Math.cos(t),n*Math.sin(t)]}function Bt(e){return Lt[e]}var Lt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},It={};for(var Rt in Lt)It[JSON.stringify(Lt[Rt])]=Rt;var qt=gt,Gt=function(){return new Vt};for(var Ht in qt){Gt[Ht+"Raw"]=function(e){return function(t){return"number"==typeof t&&(t=Array.prototype.slice.call(arguments)),qt[e](t)}}(Ht);var Nt=/(\w+)2(\w+)/.exec(Ht),Ut=Nt[1],Wt=Nt[2];(Gt[Ut]=Gt[Ut]||{})[Wt]=Gt[Ht]=function(e){return function(t){"number"==typeof t&&(t=Array.prototype.slice.call(arguments));var r=qt[e](t);if("string"==typeof r||void 0===r)return r;for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]);return r}}(Ht)}var Vt=function(){this.convs={}};Vt.prototype.routeSpace=function(e,t){var r=t[0];return void 0===r?this.getValues(e):("number"==typeof r&&(r=Array.prototype.slice.call(t)),this.setValues(e,r))},Vt.prototype.setValues=function(e,t){return this.space=e,this.convs={},this.convs[e]=t,this},Vt.prototype.getValues=function(e){var t=this.convs[e];if(!t){var r=this.space,n=this.convs[r];t=Gt[r][e](n),this.convs[e]=t}return t},["rgb","hsl","hsv","cmyk","keyword"].forEach((function(e){Vt.prototype[e]=function(t){return this.routeSpace(e,arguments)}}));var Qt=Gt,Yt=bt.exports,$t=vt,Xt=function(e){var t,r,n,a;if(t=/^((?:rgb|hs[lv]|cmyk|xyz|lab)a?)\s*\(([^\)]*)\)/.exec(e)){var i=t[1],o="cmyk"===(f=i.replace(/a$/,""))?4:3;r=Qt[f],n=t[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map((function(e,t){return/%$/.test(e)&&t===o?parseFloat(e)/100:(/%$/.test(e),parseFloat(e))})),i===f&&n.push(1),a=void 0===n[o]?1:n[o],n=n.slice(0,o),r[f]=function(){return n}}else if(/^#[A-Fa-f0-9]+$/.test(e)){var f;o=(f=e.replace(/^#/,"")).length;r=Qt.rgb,n=(n=f.split(3===o?/(.)/:/(..)/)).filter(Boolean).map((function(e){return 3===o?parseInt(e+e,16):parseInt(e,16)})),a=1,r.rgb=function(){return n},n[0]||(n[0]=0),n[1]||(n[1]=0),n[2]||(n[2]=0)}else(r=Qt.keyword).keyword=function(){return e},n=e,a=1;var u={rgb:void 0,hsl:void 0,hsv:void 0,cmyk:void 0,keyword:void 0,hex:void 0};try{u.rgb=r.rgb(n)}catch(e){}try{u.hsl=r.hsl(n)}catch(e){}try{u.hsv=r.hsv(n)}catch(e){}try{u.cmyk=r.cmyk(n)}catch(e){}try{u.keyword=r.keyword(n)}catch(e){}return u.rgb&&(u.hex="#"+u.rgb.map((function(e){var t=e.toString(16);return 1===t.length?"0"+t:t})).join("")),u.rgb&&(u.rgba=u.rgb.concat(a)),u.hsl&&(u.hsla=u.hsl.concat(a)),u.hsv&&(u.hsva=u.hsv.concat(a)),u.cmyk&&(u.cmyka=u.cmyk.concat(a)),u},Jt=i,Zt=function(e){if(!(e=e||{}).gl)throw new Error('Must specify { context: "webgl" } in sketch settings, or a WebGL-enabled canvas');var t=e.gl,r={gl:t};void 0!==e.extensions&&(r.extensions=e.extensions);void 0!==e.optionalExtensions&&(r.optionalExtensions=e.optionalExtensions);void 0!==e.profile&&(r.profile=e.profile);void 0!==e.onDone&&(r.onDone=e.onDone);var n,a=Yt(r),i=$t(),o=new Map,f=e.uniforms||{},u=Object.assign({},f);Object.keys(f).forEach((function(e){var t=f[e];"function"==typeof t?u[e]=function(e,r,n){var i=t.call(f,r,n);if(Kt(i))if(o.has(t)){var u=o.get(t);u(i),i=u}else{var s=a.texture(i);o.set(t,s),i=s}return i}:Kt(t)?u[e]=a.texture(t):u[e]=t}));try{n=a({scissor:!!e.scissor&&{enable:!0,box:{x:a.prop("scissorX"),y:a.prop("scissorY"),width:a.prop("scissorWidth"),height:a.prop("scissorHeight")}},uniforms:u,frag:e.frag||["precision highp float;","","void main () {","  gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","}"].join("\n"),vert:e.vert||["precision highp float;","attribute vec3 position;","varying vec2 vUv;","","void main () {","  gl_Position = vec4(position.xyz, 1.0);","  vUv = gl_Position.xy * 0.5 + 0.5;","}"].join("\n"),blend:!1!==e.blend?{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1}}:void 0,attributes:{position:i.positions},elements:i.cells})}catch(e){d(e)}var s=Jt(e.clearColor,"black");if("string"==typeof s){var c=Xt(s);if(!c.rgb)throw new Error('Error parsing { clearColor } color string "'+s+'"');s=c.rgb.slice(0,3).map((function(e){return e/255}))}else if(s&&(!Array.isArray(s)||s.length<3))throw new Error("Error with { clearColor } option, must be a string or [ r, g, b ] float array");var l=Jt(e.clearAlpha,1),h=!!s&&s.concat([l||0]);return{render:function(e){a.poll(),h&&a.clear({color:h,depth:1,stencil:0}),p(e),t.flush()},regl:a,drawQuad:p,unload:function(){o.clear(),a.destroy()}};function p(e){if(e=e||{},n)try{n(e)}catch(t){d(t)&&null==e&&console.warn('Warning: shader.render() is not called with any "props" parameter')}}function d(e){if(/^\(regl\)/.test(e.message))return!0;throw e}};function Kt(e){return e&&!Array.isArray(e)&&"object"==typeof e}var er={exports:{}},tr={exports:{}},rr={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},nr={},ar=function(e){var t,r,n,a,i,o=e[0],f=e[1],u=e[2];if(0===f)return[i=u,i,i];r=u<.5?u*(1+f):u+f-u*f;t=2*u-r,a=[0,0,0];for(var s=0;s<3;s++)(n=o+1/3*-(s-1))<0&&n++,n>1&&n--,i=6*n<1?t+6*(r-t)*n:2*n<1?r:3*n<2?t+(r-t)*(2/3-n)*6:t,a[s]=i;return a};var ir=function(e){var t,r,n,a=e[0],i=e[1],o=e[2],f=Math.min(a,i,o),u=Math.max(a,i,o),s=u-f;u===f?t=0:a===u?t=(i-o)/s:i===u?t=2+(o-a)/s:o===u&&(t=4+(a-i)/s);(t=Math.min(60*t,360))<0&&(t+=360);n=(f+u)/2,r=u===f?0:n<=.5?s/(u+f):s/(2-u-f);return[t/360,r,n]};var or=ar,fr=ir,ur=c;nr.RGBAToHSLA=function(e){var t=fr([e[0]/255,e[1]/255,e[2]/255]);return[Math.max(0,Math.min(360,Math.round(360*t[0]))),Math.max(0,Math.min(100,Math.round(100*t[1]))),Math.max(0,Math.min(100,Math.round(100*t[2]))),e[3]]},nr.HSLAToRGBA=function(e){var t=ur(e[0],0,360),r=or([t/360,e[1]/100,e[2]/100]);return[Math.max(0,Math.min(255,Math.round(255*r[0]))),Math.max(0,Math.min(255,Math.round(255*r[1]))),Math.max(0,Math.min(255,Math.round(255*r[2]))),e[3]]};var sr=function(e){if("string"!=typeof e)throw new TypeError("Hex code parsing must be performed on a string parameter");if(e=e.toLowerCase(),!/^#[a-f0-9]+$/.test(e))return null;var t=e.replace(/^#/,""),r=1;8===t.length&&(r=parseInt(t.slice(6,8),16)/255,t=t.slice(0,6));4===t.length&&(r=parseInt(t.slice(3,4).repeat(2),16)/255,t=t.slice(0,3));3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var n=parseInt(t,16);return[n>>16,n>>8&255,255&n,r]};var cr=function(e){if(!e||!Array.isArray(e))throw new TypeError("Must specify an array to convert into a hex code");var t=Math.max(0,Math.min(255,Math.round(e[0]||0))),r=Math.max(0,Math.min(255,Math.round(e[1]||0))),n=Math.max(0,Math.min(255,Math.round(e[2]||0))),a=e[3];void 0!==a&&isFinite(a)||(a=1);var i=Math.max(0,Math.min(255,Math.round(255*a))),o=255===i?"":(256|i).toString(16).slice(1);return"#"+((n|r<<8|t<<16|1<<24).toString(16).slice(1)+o)};!function(e){var t=rr,r=nr,n=sr,a=cr,i=c;function o(e){if("string"!=typeof e)throw new TypeError("Color parsing must be performed on a string parameter");var o,f,u;if((e=e.toLowerCase())in t?e=t[e]:"transparent"===e&&(e="#00000000"),/^#[a-f0-9]+$/.test(e))o=n(e),u=a(o),f=r.RGBAToHSLA(o);else{var s=/^((?:rgb|hsl)a?)\s*\(([^)]*)\)/.exec(e);if(!s)return null;var c=s[1].replace(/a$/,""),l=s[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map((function(e,t){return t<=2?Math.round(parseFloat(e)||0):("number"==typeof(e=parseFloat(e))&&isFinite(e)||(e=1),e)}));void 0!==l[3]&&isFinite(l[3])||(l[3]=1),"rgb"===c?(f=r.RGBAToHSLA(l),o=l):"hsl"===c&&(o=r.HSLAToRGBA(l),l[0]=i(l[0],0,360),f=l),u=a(o)}return o||u||f?{hex:u,alpha:o[3],rgb:o.slice(0,3),rgba:o,hsl:f.slice(0,3),hsla:f}:null}function f(e,t,r,n){return e=Math.max(0,Math.min(255,Math.round(e))),t=Math.max(0,Math.min(255,Math.round(t))),r=Math.max(0,Math.min(255,Math.round(r))),1!==n&&isFinite(n)&&void 0!==n?"rgba("+[e,t,r,n=Math.max(0,Math.min(1,n))].join(", ")+")":"rgb("+[e,t,r].join(", ")+")"}function u(e,t,r,n){return e=i(e,0,360),e=Math.max(0,Math.min(360,Math.round(e))),t=Math.max(0,Math.min(100,Math.round(t))),r=Math.max(0,Math.min(100,Math.round(r))),1!==n&&isFinite(n)&&void 0!==n?"hsla("+[e,t,r,n=Math.max(0,Math.min(1,n))].join(", ")+")":"hsl("+[e,t,r].join(", ")+")"}e.exports.parse=function(e){if("string"==typeof e)return o(e);var t;if(Array.isArray(e)&&e.length>=3)return o(f(e[0],e[1],e[2],e[3]));if(e&&"object"==typeof e&&(e.hex?t=e.hex:e.rgba?t=f(e.rgba[0],e.rgba[1],e.rgba[2],e.rgba[3]):e.hsla?t=u(e.hsla[0],e.hsla[1],e.hsla[2],e.hsla[3]):e.rgb?t=f(e.rgb[0],e.rgb[1],e.rgb[2]):e.hsl&&(t=u(e.hsl[0],e.hsl[1],e.hsl[2])),t))return o(t);return null},e.exports.style=function(t){var r=e.exports.parse(t);if(r){var n=r.rgba;return f(n[0],n[1],n[2],n[3])}return null}}(tr);var lr=1/12.92;function hr(e){return Math.pow((e+.055)/1.055,2.4)}var pr=function(e){var t=e[0]/255,r=e[1]/255,n=e[2]/255,a=t<=.03928?t*lr:hr(t),i=r<=.03928?r*lr:hr(r),o=n<=.03928?n*lr:hr(n);return.2126*a+.7152*i+.0722*o};return function(e){var t=tr.exports,r=rr,n=pr,a=nr,i=sr,o=cr;e.exports.parse=t.parse,e.exports.style=t.style,e.exports.names=r,e.exports.relativeLuminance=function(t){var r=e.exports.parse(t);return r?n(r.rgb):null},e.exports.contrastRatio=function(t,r){var n=e.exports.relativeLuminance(t),a=e.exports.relativeLuminance(r);return null==n||null==a?null:(Math.max(n,a)+.05)/(Math.min(n,a)+.05)},e.exports.offsetHSL=function(t,r,n,a){var i=e.exports.parse(t);return i?(i.hsla[0]+=r||0,i.hsla[1]=Math.max(0,Math.min(100,i.hsla[1]+(n||0))),i.hsla[2]=Math.max(0,Math.min(100,i.hsla[2]+(a||0))),e.exports.parse({hsla:i.hsla})):null},e.exports.blend=function(t,r,n){var a=e.exports.parse(t),i=e.exports.parse(r);if(null==a||null==i)return null;var o=a.rgba,f=i.rgba,u=(n="number"==typeof n&&isFinite(n)?n:1)*f[3];if(u>=1)return i;for(var s=0;s<3;s++)f[s]=f[s]*u+o[s]*(o[3]*(1-u));return f[3]=Math.max(0,Math.min(1,u+o[3]*(1-u))),e.exports.parse(f)},e.exports.hexToRGBA=i,e.exports.RGBAToHex=o,e.exports.RGBAToHSLA=a.RGBAToHSLA,e.exports.HSLAToRGBA=a.HSLAToRGBA}(er),{random:s,math:_,penplot:S,geometry:Ae.exports,shader:Zt,color:er.exports}}));
